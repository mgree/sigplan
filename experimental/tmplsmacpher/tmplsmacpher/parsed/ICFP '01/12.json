{"article_publication_date": "10-01-2001", "fulltext": "\n Charting Patterns on Price History Saswat Anand and Wei-Ngan Chin and Siau-Cheng Khoo School of Computing \nNational University of Singapore {saswatan,hinwn,khoos} orp.nus.edu.sg ABSTRACT Itisanestablishednotionamongfnanialanalyststhat \npriemovesinpatternsandthesepatternsanbeusedto foreastfutureprie.Asthedefnitionsofthesepatterns areoftensubjetive,everyanalysthasaneedtodefne \nandsearhmeaningfulpatternsfromhistorialtimeseries quiklyande\u00c6iently.However,suhdisoveryproessan beextremelylaboriousandtehniallyhallenginginthe \nabseneofahighlevelpatterndefnitionlanguage.Inthis paper,weproposeahart\u00adpatternlanguage(CPLforshort) tofailitatepatterndisoveryproess.Ourlanguageenables \nfnanialanalyststo(1)defnepatternswithsubjetiverite\u00adria,throughintrodutionoffuzzyonstraints,and(2)inre\u00admentallyomposeomplexpatternsfromsimplerpatterns. \nWedemonstratethroughanarrayofexampleshowreallife patternsanbeexpressedinCPL.Inshort,CPLprovides ahigh\u00adlevelplatformuponwhihanalystsandefneand \nsearhpatternseasilyandwithoutanyprogrammingexper\u00adtise. CPLisadomain\u00adspeiflanguageembeddedinHaskell. Weshowhowvariousfeaturesofafuntionallanguage,suh \naspatternmathing,higher\u00adorderfuntions,lazyevaluation, failitatepatterndefnitionsandimplementation.Further\u00admore,Haskell'stypesystemfreestheprogrammersfroman\u00adnotatingtheprogramswithtypes. \n 1. INTRODUCTION \"Apitureisworthathousandnumbers\"whenwetalk aboutstokmarket.Finanialanalystisinundatedwithin\u00adnumerablesouresofinformationwhenfaedwiththehal\u00adlengetoforeastfuturemovementofprie.Therehavebeen \nmanyattemptsamongbothresearhersandpratitionersto runhthesenumberstoforeastmoreaurately.Butfor enturies,tradershavereliedonsomethingotherthannum\u00adbersthattellmuhmore:pituresofpriemovement(prie \nhart).Onprieharts,patternsourandreourand everytimetheybodeofsimilarfutureevents.Beausepat\u00adternsaremanifestationoftheeternalstrugglebetweenbulls \nPermission to make digital or hard copies of all or part of this work for personal or classroom use is \ngranted without fee provided that copies are not made or distributed for pro.t or commercial advantage \nand that copies bear this notice and the full citation on the .rst page. To copy otherwise, to republish, \nto post on servers or to redistribute to lists, requires prior speci.c permission and/or a fee. ICFP \n01, September 3-5, 2001, Florence, Italy. Copyright 2001 ACM 1-58113-415-0/01/0009 ...$5.00. andbears.Astrongshoolofmarketanalystsknownas \ntehnialanalysts[5,1]assertthatpatternsanbeusedto foreastfuturepriemovement.Forexample,thefamous head\u00adand\u00adshoulderisapreursorofsubstantialdelineof \nprie.Therefore,thegoalofaninvestoristodisovermean\u00adingfulpatternsthatforeastensuingpriemovementfrom historialmarketdata.Butdoingsoanbeadauntingtask \nbeauseoffollowingthreereasons: 1.Thesizeofthehistorialdatawhihtheanalystswant tosearhishuge.Itistypiallyoftheorderof3000 \nyearsofdata(300ompaniesfor10years). 2.Defnitionsandinterpretationsofpatternsarevery muhsubjetiveandrefetindividualinvestor'sin\u00advestmentpersonality.Studyofpatternshasalways \nbeenonsideredanart,ratherthanasiene.Thus,a softwarewithhard\u00adodeddefnitionsforpatternsdoes notatertotheneedofallinvestors. \n3.Thisproessofdisoveringpatternsisaniterativepro\u00adess.Forexample,letussayauserwantstosearh forhead\u00adand\u00adshoulderpatternsinthehistory.Tobe\u00adgintheproess,hestartswitharoughdefnitionof \nthepattern,andthesystemfetheshimallinstanes ofhead\u00adand\u00adshoulderfromhistorythatsatisfyhisdef\u00adnition.Butthatresultsetmayontainsomeinstanes \nofhead\u00adand\u00adshoulderwhiharenotfollowedbyade\u00adlineinprie.Theuseranthenrefnehisdefnition toflteroutthoseundesirableinstanes.Thisproess \nofrefningdefnitionandpatternminingmayontinue iteratively. Inthispaper,weproposeahigh\u00adlevellanguagetofaili\u00adtatepatterndisoveryproess.Thelanguageenablesfnan\u00adialanalyststodothefollowingtasks: \n1.Defnepatternswithfuzzyonstraints.Throughin\u00adrementaladditionoffuzzyonstraintstoapattern, theuserisabletorefnepatternsiteratively. \n2.Reusepatterns.Complexpatternsarebuiltbyom\u00adposingsimplerpatternsandaddingfurtheronstraints onthem. \nWeallourlanguageChartPatternLanguage(CPL).Byem\u00adbeddingthislanguagewithinHaskell,theuseranreapben\u00adeftsfromvariousniefeaturesofHaskell.Speifally, \nHaskell'sstrongtypesysteminfersthetypeofpattern defnitionautomatially.Thisfreesprogrammers,who arefnanialanalystsbyprofession,fromthemundane \ntaskofdelaringvariablesandspeifyingtypes atask whihtheyarenotatallomfortablewithorenjoy doing. Higher\u00adorderfuntionsareusedextensivelythrough\u00adoutthesystemtoreateanaturalandonisesyntax \nforthelanguage.CPLhasbeendesignedwiththeaim ofmakingitsimilartospread\u00adsheetformulalanguage, whihallfnanialanalystsfeelfamiliarwith. \n Searhingforpatternsinpriehistoryinvolvesmulti\u00adpleonstraintssatisfation,whihhasaworstaseex\u00adponentialrunningtime.LazyEvaluationplaysaru\u00adialrolebyautomatiallyavoidingunneessaryom\u00adputationduringsearhingforpatterns. \n Thepaperisorganizedasfollows:InSetion2,wegive anoverviewofpatternsusedforfnanialforeasting.We thendesribe,inSetion3,asetofombinatorsforexpress\u00adingtehnialindiators.InSetion4,weshowhowsimple \npatternsanbedefnedinCPL,followedbydefningom\u00adpositepatternsinSetion5.AformaltreatmentofCPLis thenpresentedinSetion6.Weaddresstheissueofpattern \nreusabilityinSetion7.Next,wesharesomenotesonim\u00adplementationofCPLinSetionS.Welisttherelatedwork inSetion9beforeonludinginSetion10. \n 2. WHAT IS IN A CHART PATTERN? Imagineyouarethemanagerofamutualfund.Overthe yearsyouhavepurhasedafewhundredthousandshares \nofaompany.Afterseeingthestokriseforalmostayear (Figure1),youaregettingnervousaboutontinuingtohold thestok.Soyoutellyourtradingdepartmenttodumpall \nyoursharesaslongasitgets13..Sineyourfundhasa largeblokofsharetogetridof,prieannotriseabove13 .. Wordgetsaroundandotherbigplayersjumpinandstart \nselling.Thisaggressivesellingsatiatesthedemandandprie goesdown.Eagerbuyers,viewingtheprieofthestokasa \nsteal,demandmoresharesandpriestartsrising.Butwhen theprietouhes13.level,yourfundsellsmoreshares, efetivelyhaltingitsadvane.Thesharekeepswrigglingup \nanddownafewtimesandformsatriangleshape\u00adlikepattern onthehart,asshowninFigure1.Whenyouaredonewith sellingandsupplydepletes,buyingpressureatapultsprie \nabove13. levelandstrongbullishtrendisestablished.So ifahartanalystdetetsthistrianglepattern,heknows \nwhatisookinginthepit,andmaywishtogetintobuying spreeonepriebreaksoutfromthepattern.Thisstory tellshowpatternsareformedonhartsunderpartiular \nirumstanesandheneitislogialtobelievethatprie anrepeatitsfeat.Someexamplesofpopularpatternsare head-and-shoulder,up-with-handle,retangle,triangle,fag, \nwedge,bump-and-run-reversal,et.. Chartpatternsdefnethemovementofrawprielikelos\u00adingoropeningprieortheirderivatives.Forexample,mov\u00adingaverageisarunningaverageofprie.Weallthese \nrawpriesandtheirderivativestehnialindiators,beause theyindiatethestateofthemarket.Indiatorslikemov\u00adingaveragearemathematialformulaeexpressedinterms \nofthepries/volumeassoiatedwithadisretesetoftime periods. Stokhartsareusuallydisplayedasbarharts.Figure \n2showsabarhart.Here,thereisonebarforeahtime   period.Onetimeperiodanbeadayonadailyhart,or aweekonaweeklyhart,et..Eahbarisassoiatedwith \nfvekindsofvaluesforthattimeperiod;theyare:thelose prie,openprie,highprie,lowprie,andthenumberof transations(volume)forthattimeperiod.Throughoutthe \npaperweusebar,timeand\"aday\"interhangeablywithout lossofgenerality. 3. TECHNICAL INDICATORS Werepresentbarsbyintegers,andtehnialindiators \narehenefuntionsfrombarstovalues. typeIndiatora=Bar-(Maybea) Indiatortakesabarbandreturnsanindiatorvaluefor \nthatbar.Sineeahbarisassoiatedwithfvebasifelds: high,low,open,loseprie,andtransationvolume,wehave fveprimitiveindiators:high,low,open,loseandvolume. \nThus,wehave high,low,open,lose::IndiatorPrie volume::IndiatorVolume Moreompliatedindiatorsanbeomposedofthesimpler \nones,withthehelpofaombinatorlibrary. Asthefrstexample,wedefneatehnialindiatorfor typialprie,whihistheaverageofthehigh,lowandlose \npriesofaday: tPrie::IndiatorPrie tPrie=(high+low+lose)/3.0  Notethatanyarithmetiombinationofindiatorsisalso \nanindiator,beauseindiatorsareaninstaneoftheNum lass(delaration11inFigure3),whihhasoperations 1 foraddition,subtration,multipliation,et.:Indiators \nandtheiroperationsarereminisentofFrans'behaviours [S],andofobservableusedinomposingfnanialontrats [1S];operationsonthemaresupportedbyombinatorslike \nlift1,lift2,et.thatliftfuntionstotheindiatorlevel,We omitthedetailhere. Itisveryommonwhiledefningindiatorstousepast \nvaluesofanindiator.Tosupportthis,wehaveaombina\u00adtor(.)whihenablesrelativeindexingintopastdata.Given abar(time),whileanindiator,sayhigh,evaluatestothe \nhighprieatthebar,high.nyieldsthehighprieofnth 2 previousbar.(.)isdefnedasfollows: (.)::Indiatora-Integer-Indiatora \nind.n=Ab.ind(b-n) RelativeindexingisusedtodefneMovingaverage.Itis apopularindiatorwhihrepresentsurrentmarkettrend \nbysmoothingsmallpriefutuations.An\"n\u00adday\"mov\u00adingaverageofanindiatoronagivendayisalulatedby averagingthevaluesoftheindiatorforpreviousndays: \nmovingAvg::(Numa)=Integer-Indiatora -Indiatora movingAvgnprie=(sumlastnbar)/n wherelastnbar=takeInprie \n1 Itsu\u00c6estounderstandthattheusualarithmetiopera\u00adtionsworkonindiatorstoo. 2 InHaskell,aninfxoperatoranbeturnedintoafuntion \nbyenlosingitinbraes.Conversely,afuntionanbe turnedintoaninfxoperatorbyenlosingitinbakquotes. Figure1:Triangle \nFuntionsumisastandardHaskellfuntionforsumming upalist.takeIretrievesthevalueofanindiatorforthe lastndays,andisdefnedthroughrelativeindexing: \ntakeI::Integer-Indiatora-[Indiatora] takeInf=map(f)[0..(n-1)] Day 0 1 2 3 4 5 6 7 ClosePrie 4.2 4.5 4.3 \n4.1 4.5 4.6 4.3 4.4 Day S 9 10 11 12 13 14 15 ClosePrie 4.2 4.3 4.4 4.1 3.9 3.6 3.7 3.S Intheabovetableifweevaluate(takeI5lose)15,weget \nalistoflosingpriesfrom15thdaydownto11thday. Nowweanexplainwhyanindiatorevaluatestoavalue oftheMaybetype.MaybeisdefnedinHaskellasfollows \n[19]: dataMaybea=NothingIJusta Fromthe\"n\u00adday\"movingaveragedefnitionweanseethat thefrstbarinthepriehistorywhenmovingaveragean \nbealulatedisthenthbar.Beforethisbar,omputationof \"n\u00adday\"movingaveragewillrequirepriesbeforethestart ofhistory,whihisnotavailable.Bymakingtheresultofin\u00addiatorMaybetype,suessfulomputationofanindiator \nwillreturnavalueoftheformJustv,wherevisthedesired value.ValueNothingdenotesanerrorinomputation,as explainedabove. \nOneofthepopularuseofmovingaverageistoompare itwiththerawprie,sayloseprie.Abuysignalisgen\u00aderatedwhentheseurity'surrentprierisesfrombelowits \nmovingaveragetoaboveit,andasellsignalisgeneratedif urrentpriefallsfromaboveitsmovingaveragetobelow it.FollowingaredefnitionsoftheaboveruleinCPL: \nbuy,sell::IndiatorBool buy=lose'riseAbove'(movingAvglose13) sell=lose'fallBelow'(movingAvglose13) riseAbove,fallBelow::(Numa)= \nIndiatora-Indiatora-IndiatorBool f1'riseAbove'f2=(f1>f2)&#38;&#38;(f11)<(f21) f1'fallBelow'f2=(f1<f2)&#38;&#38;(f11)>(f21) \nAsshowninFigure3,asaresultofdelaration4andmaking IndiatorBooltypeaninstaneofLogilass,indiatorsan beomparedandlogiallyombinedthrough(&#38;&#38;)and(II) \noperationsasintheaboveexample. Amoreomplexexampleoftehnialindiatorismomen\u00adtum.Thisformulaomputesanumber(between0and1) \nthatsignifesthemomentumofthelast14\u00addaytrend.Ifthe Figure2:Insideday momentumishigh(loserto1),thetrendisbullish,and \nmoneyshouldbeputalongthetrend.Momentumisal\u00adulatedintermsofthetotalprieinreaseinallthe\"up days\"andthetotaldereaseinallthe\"downdays\".Aday \nisalledan\"upday\"ifitsloseisgreaterthanitsprevious day'slose;otherwise,itisalleda\"downday\".Forexam\u00adple,inthepreedingtabletheupdaysare1,4,5,7,9,10,14,15 \nandthedowndaysare2,3,6,S,11,12,13.Themomentumis alulatedbythefollowingformula: momentum=sum up/(sum down+sum \nup) wheresum upsumsupthe\"dif.ofaday\"forallupdays, andsum downsumsupthe\"dif.ofaday\"foralldown days.A\"dif.ofaday\"istheabsolutediferenebetween \ntheday'sloseandthepreviousday'slose.InCPLthis translatesto: momentum::Integer-IndiatorPrie momentumn=sum \nup/(sum down+sum up) where sum up=sum(takeInup day) sum down=sum(takeIndown day) up day=ifI(lose>lose1)(lose-lose1)0 \ndown day=ifI(lose:lose1)(lose1-lose)0 FuntionifImimistheonditionaloperationattheindia\u00adtorlevel;itisdefnedasfollows: \nifI::IndiatorBool-Indiatora-Indiatora ifIondf1f2=Ae.ase(onde)of Nothing-Nothing JustTrue-f1e JustFalse-f2e \n Toa(non\u00adfuntional)programmer,thefatthatmomen\u00adtumisdefnedoveraperiodoftimemayindiateauseof for\u00adlooponstrut.Buttomanyfnanialanalysts,this \nseeminglyinnouousontrolstrutureposeasteeplearning urve,whereastheyareveryomfortablewiththeformula\u00adlikelanguageofspreadsheets.Alittlerefetiononhowmo\u00admentumisalulatedinaspreadsheetappliationreveals \nmuhsimilaritytotheabovedefnition.So,anybodywho anworkwithaspreadsheetwillfndCPLeasytouse.To thisefet,higher\u00adorderfuntionsplayaruialroleinre\u00adatingsuhanintuitivespreadsheet\u00adlikesyntax. \nWeendthissetionbyintroduingatehnialindiator whihisreursivelydefned.Oneofthepopularreursive indiatorsisexponentialmovingaverage.Thisvariantof \nmovingaverageisexponentiallyweightedsuhthatmore reentvaluesaregivenhigherweightthanoldervalues.The formulaforanexponentialmovingaverage(forlosingprie) \nattimet,emvgt,isasfollows: emvgt =a*emvgt.1+(1-a)*loset,0<a<1 emvgo=loseo Theexponentialmovingaverageforthefrstday(day0)in \napriehistoryisjustitslosingprie.Atanyotherday,the exponentialmovingaverageisomputedbysummingthe weightedlosingprieofthatdayandtheweightedmoving \naverageofthepreviousday.InCPL,thisanbedefnedas follows: emvg::IndiatorPrie emvg=(0.S*(emvg1)+0.2*lose)'seed'lose \nseed::Indiatora-Indiatora-Indiatora seedi1i2=Ab.if(r==Nothing)theni2b elser wherer=i1b Inthedefnitionabove,aistakenas0.S.seedfuntion \ntakestwoindiatorsi1andi2,wherei2representstheseed indiator.Givenabarb,seedreturnsthevalueofseed indiatori2if(i1b)annotbeevaluated.Otherwise,it \nreturnsthevalue(i1b).  4. CHART PATTERNS Chartpatternsaregeometrialshapes.Theyapturegen\u00aderaltrendsormovementsofprieoveraperiodoftime.We \nadoptaonstrutiveapproahfordefninghartpatterns: hartpatternsarebuiltfromsixprimitivepatternsbar, up,down,horizontal,resistanelineandsupportline,their \nderivativesandomposites. 1.Thepatternbarharaterizespriemovementatapar\u00adtiulartime. 2.Thepriemovementfromatimeatoatimebonsti\u00adtutesanuppatternifhight<highb,foralltE[a,b) \nandlowt>lowa,foralltE(a,b]. 3.Thepriemovementfromatimeatobonstitutes adownpatterniflowt>lowb,foralltE[a,b)and \nhight<higha,foralltE(a,b]. 4.Thepriemovementfromatimeatobonstitutesa horizontalpatterniflosetisapproximatelythesame \nasloseb,foralltE[a,b). 5.Alinesegmentfromatimeatobonstitutesaresis\u00adtanelinepatternifforalltE[a,b],hightfallsonor \nbelowtheline,andthereareatleast2daysin(a,b) whentherespetivehighpriesfallsontheline. 6.Alinesegmentfromatimeatobonstitutesasupport \nlineifforalltE(a,b),lowtfallsonorabovetheline, andthereareatleast2dayswhen(a,b)whenthe respetivelowpriesfallsontheline. \nWedistinguishbetweenapatternandapatterninstane.A patternisadesriptionofashapeandapatterninstaneis anourreneofthepatterninthepriehistory.Type\u00adwise, \npatternsareoftypePattern,andpatterninstanesareof typePatt. Primitivepatternsaredefnedbytheprimitivefuntions \nbar,up,down,hor,resandsprt,respetively. 4.1 Landmarks &#38; Components Studyinhumanvisionsystem[6]showsthathumansfnd \nitnaturaltodesribepatternsbasedontheiranhorpoints. Intheirproposalofanewmodelforpatternmathingin time\u00adseriesdatabases[17],Perngetal.alltheseanhor \npointslandmarks,andshowthattheyareruialforefe\u00adtivepatternmathing.Wefollowthesameterminologyfor theanhorpointsofahartpattern/patterninstane.Fur\u00adthermore,weoftenuselandmarkstodefneonstraintsof \nomplexpatterns.Landmarksarereferredtobytheirpo\u00adsitionsinthepriehistory,i.e.,thevaluesoftypeBarin CPL.Thus,anuppatterninstanehastwolandmarks:the \nstartandendpointsoftheinstaneandsohavetheother primitive\"line\"patterns:down,horizontal,resistaneand supportlines.Ontheotherhand,abarpatterninstane \nhasjustonelandmark,indiatingthetimewhenthebar ours.Wewilldesribethelandmarksofomplexpattern instaneswhenwedisusspatternomposition.InCPL,we \nhaveabuilt\u00adinfuntionlms::Patt-[Bar],thattakesin apatterninstaneandreturnsitslistoflandmarks. Besidesusinglandmarks,weanalsodiretlyaessthe \nsub\u00adomponentsofaompositepattern.sub::Patt\u00ad[Patt]returnsalistoftheomponentpatterninstanesofa ompositepatterninstane.Forprimitivepatterninstanes, \nsubreturnsasingletonlistontainingtheprimitive.We shallprovidedetailsoflmsandsubinSetion5. 4.2 Constrained-by \nOperation Thefrstpatternweshallpresentisabarpatternalled insideday.Thispatterndesribesthemarketbehaviorofa \nstokforoneday.InFigure2,eahinsidedayhasairular markaboveit.Followingisadefnitionofinsideday: insideDay::Pattern \ninsideDay=barIXAu.let[t]=lmsu in[lowt>(low1)t, hight<(high1)t]  Theabovedelarationanbeinterpretedasfollows:An \ninsidedayisabarpatternsuhthat,foranyofitspattern instanesourringatatimet,itslowprieisgreaterthan thepreviousday'slow,anditshighprieislessthanthe \npreviousday'shigh. The(IX)operationassoiatesaonstraintfuntiontoa pattern.Ithasthefollowingtype: (IX)::(ToFuzzya)=Pattern\u00ad(Patt-[a])-Pattern \n Thisoperationprovidesanelegantandhigh\u00adlevelwayof defningpatterns.Apatternanbedefnedintwoparts: inthefrstpart,sub\u00adomponentsaredefned.Inthese\u00adondpart,aonstraintfuntionspeifesalistofglobalon\u00adstraintsaboutthepattern.Theseonstraintsareusuallyex\u00adpressedintermsofthepattern'slandmarksandsub\u00adomponents. \nTheywillbeevaluatedtovalues,thetypesofwhihbelong tothelassToFuzzy. lassToFuzzyawhere toFuzzy::a-Fuzzy \n Basially,atypebelongstothelassToFuzzyifitsvalues anbeonvertedtofuzzyvalues.Currently,thesetypes are:Fuzzy,Bool,MaybeFuzzy,andMaybeBool.Werefer \nthereaderto[4]fordetaildefnition. InthedefnitionofInsideDayoperandsto(>)and(<) operatorsarevaluesoftypeMaybePrie.Thisisvaliddue \ntodelaration3inFigure3. 1.lassCrispOrdabwhere (>),(<),(==)::a-a-b 2.instane(Orda)=CrispOrdaBoolwhere \n... 3.instane(Orda)= CrispOrd(Maybea)(MaybeBool)where ... 4.instane(Orda)= CrispOrd(Indiatora)(IndiatorBool)where \n... 5.lassFuzzyOrdabwhere (>),(-),(x)::a-a-b 6.instane(Orda)=FuzzyOrdaFuzzywhere ... 7.instane(Orda)= \nFuzzyOrd(Maybea)(MaybeFuzzy)where ... S.instane(Orda)= FuzzyOrd(Indiatora)(IndiatorFuzzy)where ... 9.lassLogiawhere \n(&#38;&#38;),(II)::a-a-a Instanesofthislassare,Fuzzy,(MaybeFuzzy), (IndiatorFuzzy),Bool,MaybeBooland \nIndiatorBool 10.instane(Numa)=Num(Maybea)where ... 11.instane(Numa)=Num(Indiatora)where ... Figure3:PartialListofHaskellTypeClassesfor \nCPL Notiethattheonstraintfuntionisdefnedoverapat\u00adterninstane,ratherthanapattern.Thisisneessary,as theonstraintfuntionisevaluatedwithrespettoapat\u00adterninstane.However,itisnotwrongtoviewtheon\u00adstraintfuntionaspartofapattern,sinetheonstraint \nfuntionappliesonsistentlytoallinstanesofthatpattern. Similarly,weapplylmsfuntiontoapatterninstane,even \nthoughwefrequentlytalkaboutthelandmarksofapattern. Nowletusintroduefuzzyonstraintsthroughasimple patternalledbigUp.Thisisaprimitiveuppatternwitha \nonstraintfuntionspeifyingthatinreaseinprieisusu\u00adallygreaterthan10units.InCPL,thisanbedefnedas follows: \nbigUp::Pattern bigUp=upIXAu.let[p,q]=lmsu in[(highq-lowp)>10] Notetheuseoffuzzyoperator>indefningtheonstraint. \nThisrefetssomedegreeofsubjetivityinthedefnitionof apattern,asisfrequentlydoneindesribingpatternsthat \nannotbequantifedexatly.Consequently,itisneessary toattaheahpatterninstanewithafuzzyvalue,soas toprovidetheuseragaugeonhowloselythatinstane \nmathesthespeifedpattern. Fuzzyvaluesarefoating\u00adpointsbetween0.0and1.0: typeFuzzy=Float [0.0,1.0] Forexample,4.9>5.0and4.9x5.0bothhavetruth \nvaluesgreaterthan0andlessthan1,whereasboth4.9>5 and4.9=5havethetruthvalueFalse.Evaluationoffuzzy onstraintsisdonethroughthesupportoffuzzymembership \nfuntions[13].Intheexampleof4.9x5.0,weanusethe followingtriangularfuntiontoomputethefuzzyvalue: (x+a).y \n,y>x faxy=a y.(x.a) a ,y:x Thefuntionfomputesthefuzzyvalueforyxx.The valueofainthefuntiondeterminestheamountoffuzzi\u00adness.Thebiggera'svalueis,themorevalueslyingfarther \nfromxwillhavenon\u00adzerotruthvalue.InCPL,adefault valueissetforathatanbetunedbyexperienedusers. ForfurtherdetailsonodingfuzzylogiinHaskellreaders \narereferredtotheworkbyMeehamandJoy[15]. Toenabletheo\u00adexisteneoffuzzyandrispoperations, wedefnetwolassesofomparators:FuzzyOrdandCrispOrd \nasshowninFigure3.TheCrispOrdlassonsistsofonven\u00adtionalrispoperators>,<and==,whihreturnvalues oftypesBool,MaybeBoolorIndiatorBooldependingon \nthetypeofoperands.TheFuzzyOrdlassofoperatorsare >,-,x.Similartorispoperatorsthesefuzzyoperators tooreturnFuzzy,MaybeFuzzyandIndiatorFuzzytypesde\u00adpendingonthetypeofoperands. \nNotethatlikeIndiator,(Numa)=Maybeaanbe arithmetiallyoperatedasintheexampleofbigUp.This issupportedbymaking(Numa)=Maybeatypeanin\u00adstaneNumlassforasshowninFigure3(delaration10) \n.  5. COMPOSING PATTERNS Inthissetion,wedesribehowsimplepatternsanbe omposedtoonstrutinterestingandusefulhartpatterns. \nWeintroduetwooperations,\"followed\u00adby\"and\"overlay\", whihenablestheonstrutionofmostofthelinepatterns desribedintheEnylopediaofChartPatterns[5]. \n5.1 Followed-By Composition Wedemonstratefollowed\u00adbyompositionbydefninga patternhill,whihhasanuppatternfollowedbyadown \npattern,suhthatthetwo\"bottoms\"ofthehill(i.e.,the startpointofupandtheendpointofdown)arealmost atthesamelevel.InCPL,weusethefollowed\u00adbyopera\u00adtion,denotedby(\u00bb),toonatenatethesetwopatterns, \nandtheonstrained\u00adbyoperation(IX)toexpresstheglobal onstraintofthehill. hill=(up\u00bbdown)IXAh.let[a,b,]=lmsh \nin[lowaxlow] The(\u00bb)operationhasthefollowingtype: (\u00bb)::Pattern-Pattern-Pattern Ittakesintwopatternsandonatenatesthemsothatthe \ntwosub\u00adpatternsjoinatonepoint.Speifally,theright\u00admostlandmarkoftheleftpattern\u00adoperandmustbeidenti\u00adaltotheleftmostlandmarkoftherightpattern\u00adoperand. \n  Figure4:HeadandShoulder Figure5:Retangle Inlistingitslandmarks,welistthelandmarksofitsleft operand,followedbythelandmarksofitsrightoperand, \nwhileensuringthattheommonlandmarkisnotdupliated. Consequently,thenumberoflandmarksoftheomposite patternwillbeonelessthanthesumofthenumberofland\u00admarksofthetwosub\u00adpatterns.Ahillpatterninstanethus \nhasthreelandmarks:thelefthillbottom,thepeak,andthe righthillbottom,inthatorder. WementionedbriefyinSetion4thatfuntionsubre\u00adtrievessub\u00adomponentsofapatterninstane.Forapat\u00adternomposedviafollowed\u00adbyoperation,suboperatesre\u00adursivelyonitsomponentstoretrievealistofomponent\u00adpatterninstaneswhihareeitherprimitiveoroverlaypat\u00adterninstanes.Anoverlaypatternisaompositepattern \nwhosetop\u00adlevelompositionisanoverlayoperation.Inthis list,omponentsofleftoperandareplaedbeforethoseof \nrightoperand.Forexample,applyingsubtoahillpattern instanewillyieldalist[p,q],wherepandqaretheup instaneandthedowninstanerespetively. \nWenowusethehillpatterntofurtheromposeapattern thatanatuallyearnyoubigmoney.Head-and-Shoulder isoneofthemostpopularpatterns.Itlookslikeasitsname \nsuggests.AsFigure4shows,weandefnethispatternas abaktobakonatenationofthreehills,suhthatthe middlehill(head)ishigherthantheothertwo(shoulders), \nandthepeaksoftheshouldersarealmostatthesameheight. InCPL,thistranslatesto, head shoulder=(hill\u00bbhill\u00bbhill)IXAhs. \nlet[a,b,,d,e,f,g]=lmshs in[highd>highb, highd>highf, highbxhighf]  5.2 Overlay Composition Itisnotunommontoseemultiplepatternsappearing \nduringasingletimeintervalofthepriehistory,witheah patternmeasuringdiferentaspetsofpriemovement.In CPL,thisisaomplishedbytheoverlayoperation,denoted \nby(<>). (<>)::Pattern-Pattern-Pattern Thistakesintwopatterns,andproduesaompositepat\u00adtern,wherethetwoinputpatternsourexatlyatthesame \ntimeperiod.Speifally,bothpatternshavethesameleft\u00ad mostlandmark,aswellasthesamerightmostlandmark. Inlistingitslandmarks,welistthelandmarksofitsleft \noperand,followedbythelandmarksofitsrightoperand, whileensuringthattheommonlandmarksarenotdupli\u00adated.Furthermore,thefrstandlastlandmarksinthere\u00adsultlististhefrstandlastlandmarksofanyofitsoperand \nrespetively.Consequently,thenumberoflandmarksofthe ompositepatternwillbetwolessthanthesumofthenum\u00adberoflandmarksoftheomponentpatterns. \nApplyingsubfuntiontoanoverlaypatternreturnsom\u00adponentsthatareeitherprimitiveorfollowed\u00adbyinstanes. Afollowed-byinstaneisaompositeinstanewhosetop\u00adlevelompositionisthefollowed\u00adbyoperation.Likeinase \noffollowed\u00adbyoperation,thislistofpatterninstanesare thenorderedsuhthatomponentsoftheleftoperandof theoverlayoperatorarelistedbeforetheomponentsofthe \nrightoperand. Asanexampleofoverlayoperation,wedefneanarea patternwhihisobtainedbyoverlayingasupport\u00adlinepat\u00adternonaresistane\u00adlinepattern.Theresultingpatternisso \nsimplethatbyitsown,itisnotuseful,butitanbeused asabuildingblokforothermeaningfulpatterns. area=res<>sprt \n Thisareapatternhastwolandmarks,signifyingthestart\u00adingandtheendingtimeofthepattern(thesearealsothe startingandtheendingtimeoftheomponents:resand \nsprt). Now,onsideranareapatternthatendsatatimewhen thelosingprieeitherrossesabovetheresistanelineor fallsbelowthesupportline.Priebreakingoutofanyof \nthetwolinesisknownas\"breakout\".AnupAreapattern isanareawithanupsidebreakout;i.e.,losepriemoves pasttheresistaneline.Dually,adownAreapatternisan \nareawithdownsidebreakout.InCPL,theyaredefnedas follows: upArea=areaIXAu.let[m,n]=subu [a,b]=lmsn in[breakoutmb] \ndownArea=areaIXAu.let[m,n]=subu [a,b]=lmsn in[breakoutnb] Intheseexamples,mandnreturnedfromevaluating(subu) \naretheinstanesofresistanelineandsupportlinerespe\u00adtively.Funtionbreakouttakesinaline(eitherasupportor \naresistaneline)andalandmarkb.Iftheinputlineisa supportline(n),itevaluatestoTrueinasethepriegoes belowthesupportlineattime(b+1).Otherwise,itevalu\u00adatestoFalse.Iftheinputlineisaresistaneline(m),then \nitevaluatestoTrueinasethepriegoesabovethelineat time(b+1).ElseitreturnsFalse. Withthesebuildingbloks,weandefneausefulpattern \nalledretangle.Thispatterndenotesonfusionanduner\u00adtaintyofthemarket.Itisdevelopedwhenthereisdoubt abouttheprieofanunderlyingstok;i.e.,tradersdonot \nknowifthestokshouldbepriedhigherorlower,andthe stok'spriekeepsfutuatinginaverynarrowrangewhih isdefnedbytwonearlyparallellines.Whenaretangle \npatternours,fnanialanalystslookfortheprietobreak ineitherdiretion.Followingisadefnitionofretanglepat\u00adternonstrutedontopofdownArea. \nret=downAreaIXAu. let[m,n]=subu in[slopemxslopen] Funtionslopetakeseitherasupportoraresistanelineand \nreturnsitsslope. Ournextexampleisanexotipatternalleddiamond. Diamondisformedbyoverlayingaseriesofsupportlines \nonaseriesofresistanelines.Figure6showsadiamond onhart.Thispatterngenerallyoursbeforepriestarts trendingineitherupwardordownwarddiretion,depending \nonwhetherthepriebreaksupordownfromthediamond respetively.InCPL,adownwardbreakingdiamondisde\u00adfnedasfollows: \ndmnd=((res\u00bbres)<>(sprt\u00bbsprt))IX Au.let[rlines,slines]=subu [m,n]=subrlines [p,q]=subslines [,d]=lmsq \nin[divergemp,onvergenq,breakoutqd] Givenadiamondinstaneu,(subu)returnsitsomponents, theresistanelines(rlines)andthesupportlines(slines) \nrespetively.Theselinesanbefurtherdeomposedusing thesubfuntion.Graphially,theomponentsarelabelled asfollows: \ndlinesslines  (rs \u00bbrs)<> (sprt\u00bbsprt)  n pq Intheonstraintfuntionspeifation,bothonvergeand divergefuntionstaketwolines(eithersupportorresistane) \nandreturnTrueifthesetwolinesonvergeordivergerespe\u00adtively,otherwisetheyreturnFalse. Weendthesetionbydefningapatternonstrutedvia \nbothompositionoperations.Afagpatternisformedwhen arapidsteepdelineoftheprieisfollowedbyaongestion areawherethepriemovesbetweentwoparallellines(a \nretangle)forsomedaysbeforefallingofindownwarddi\u00adretion.AninstaneofafagpatternisshowninFigure7. Afnanialanalystmaywishtodefneafagasfollows: \nfag =(down\u00bbret)IXAf. let[dn,rt]=subf [a,b,]=lmsf pr=higha in[(lendn)-5, pr-(lowb)>0.1*pr, (lenrt)-10] \n Here,afagisdefnedbyanDownpatternfollowedbya retanglepattern(defnedearlier).Thelandmarksare:a marksthebeginningofdown;bdenotesthejointbetween \ndownandretaswellasthestart\u00adpointofret;theend\u00adpointofret.Component\u00adwise,dnreferstothedownpat\u00adtern,rtrefertotheretangle.Theonstraintfuntionasso\u00adiatedwiththefagspeifesthatthedownpatternusually \nlastslessthan5days,thepriedropduringdownpatternis around10%ormore,andprieongestion(theret)should usuallylastlessthan10days.lenfuntionsreturnsthe \ndifereneofendandstartlandmarksofapattern. Insummary,wehavedesribedanefetivemeansforon\u00adstrutinghartpatterns.Thisisformulatedasahartpat\u00adternlanguage(CPL).FigureSdepitsCPL'ssyntax. \n 6. DEFINITION OF PATTERN COMBINA-TORS Inthissetion,weprovideaformaldefnitionofthepat\u00adternombinators,togetherwithsomeoftheessentiala\u00adessorfuntionstopatterninstanes.Apatternisinter\u00adpretedasafuntionwhihtakesatimeinterval(b1,b2)and \nreturnsa(possiblyempty)listofpatterninstanes,allof whihourentirelywithinthetimeintervalintheative priehistory.Type\u00adwise,wehave: \nPattern::(Bar,Bar)-[Patt] Weprovideanotationfordesribingthissetofpattern instanes. DEFINITION1(SETOFPATTERNINSTANES).Givena \npatternpandatimeinterval(b1,b2),P(b1,b2,p)istheset ofallpatterninstanesofpthatstartfromt1,t1E[b1,b2] \nandendatt2,t2E[b1,b2],t2?t1. DatatypeforpatterninstanesaredefnedinFigure9. Apatterninstaneonsistsofinformationshowingwhere \nexatlyinthepriehistorydoesitour,aswellasafuzzy measureindiatinghowloselyitmathesthepatterndef\u00adnition.Notethatabarpatterninstanehastheonstrutor \nnamedBar;theargumenttothisonstrutorisatimevalue (oftypeBar).Eahoftheotherprimitivepatterninstanes keepsapairofbarsindiatingthestartingandendingtimes \nPattern::=PrimitiveI(Pattern) IPatternPatOpPattern IPatternIXAvar.FCExp Primitive::=barIupIdownIhorIsprtIres \nPatOp::=\u00bbI<> FCExpFuzzyonstraintExpressions VarVariables Figure8:SyntaxofChartPatternLanguage Figure6:Diamond \nFigure7:Flag  oftheinstane.Furthermore,aninstaneofsupportline orresistanelinealsomaintainsitsSlope(whihisaninte\u00adger).ConstrutorFbapturesfollowed\u00adbyinstanesandits \nomponentpatterninstaneswhihareeitherprimitivesor overlay\u00adpatterninstanesarekeptinalist;similarly,on\u00adstrutorOverrepresentsoverlayinstanesandkeepsalistof \nitsomponentpatterninstaneswhihareeitherprimitives orfollowed\u00adbypatterninstanes. dataPatt=BarBarFuzzy \nIUp(Bar,Bar)Fuzzy IDown(Bar,Bar)Fuzzy IHor(Bar,Bar)Fuzzy IRes(Bar,Bar)SlopeFuzzy ISprt(Bar,Bar)SlopeFuzzy \nIFb[Patt]Fuzzy IOvr[Patt]Fuzzy Figure9:DataTypeforPatternInstanes Assoiatedwithapatterninstanearesomeaessors: \nFuntionfuzzytakesapatterninstaneandreturnsitsfuzzy values.Itsdefnitionistrivialandthusomitted.Funtion \nsubretrievesaninstane'ssub\u00adomponents: sub::Patt-[Patt] subp=asepof (Ovrpsv)-ps (Fbpsv)-ps otherwise-[p] \n Funtionlmsretrievesaninstane'slandmarks,andisde\u00adfnedasfollows: lms::Patt-[Bar] lmsp=asepof (Ovrpsv)-lmsOvrp \n(Fbpsv)-lmsFbp (Barbv)-[b] (Up(b1,b2)v)-[b1,b2] (Down(b1,b2)v)-[b1,b2] ... -(Omittted) lmsFb(Fbpsv)=let(bs::bss)=maplmsps \ninbs++onat(maptailbss) lmsOvr(Ovrpsv)= letlss=maplmsps ls=headlss b1=headls b2=lastls inif(lengthls)==1thenls \nelseb1:(onat(maputlss)++[b2])  Haskellfuntiontailreturnsthetailofalist;onatfattens alistofsub\u00adlists;headandlastreturnsthefrstandthelast \nelementinalist,respetively.Reallthatinomputinglms, weavoiddupliationofthoselandmarksommontomultiple omponent\u00adpatterninstanes.Forfollowed\u00adbyomposition, \nwedisardthebeginninglandmarkofall,exeptthefrst, followed\u00adbyomponents.Foroverlayomposition,weem\u00adployalistfuntionuttodisardboththefrstandthelast \nlandmarksofalloverlayomponents.Thedefnitionofutis obvious,andthusignored.Furthermore,wemakeuseofthe followingfatwhenomputingthelandmarksofanoverlay \npatterninstane:Sineallomponentsofoverlayomposi\u00adtionmustbeginatthesametimeandendatthesametime, ifoneoftheomponentisabarprimitive(thusonsisting \nofonlyonelandmark),thenallomponentinstanesmust bebarprimitivestoo.Inthisase,lmsreturnsonlyone landmark. \nConstrainedPatternsThe(IX)operationintrodues onstraintsintoapattern.Wegiveaset\u00adtheoretidefnition of(IX)asfollows: \nP(b1,b2,pIXf)= {ins1IinsEP(b1,b2,p)1v=fuzzyins1 v . =(foldrmin1.0(fins))1 v .>0.01ins1=addFuzzyins(minvv \n.)} Toperformtheonstrained\u00adbyoperation,wefrstevaluate theargumentpatternptoalistofpatterninstanes.Eah \nofthesepatterninstanehasafuzzyvaluedenotedbyv. Wethensolvethelistofonstraintsforeahofthesein\u00adstanes,makinguseoftheknowledgeaboutindividualin\u00adstane.Solvingtheonstraintswithrespettoaninstane \nproduesalistofvalues,whiharethenonvertedtovalues oftypeFuzzy.(foldrmin)operationisthenperformedon thislistoffuzzyvalues,signifyingaonjuntionoperation. \nIftheresultisnon\u00adzero,minimumofthisresultandvis thenewfuzzyvaluefortheinstane.Funtion(addFuzzy) isdefnedasfollows: \naddFuzzy(Fbpsfz)fz. =Fbps(minfzfz.) addFuzzy(Ovrpsfz)fz. =Ovrps(minfzfz.) addFuzzy(Barbfz)fz. =Barb(minfzfz.) \naddFuzzy(Up(b1,b2)fz)fz. =Up(b1,b2)(minfzfz.) addFuzzy... (Omitted) Fromtheuser'sperspetive,(IX)operationenableshimto \nadaptanexistingpatterntothedesiredone.Operationally, (IX)workslikeaflter.Thisisexpressedbythefollowing \nproperties: PROPERTY1.Letpbeapatternandfbetheonstraint funtiononpatterninstanesofp,then 1.Foranytimeinterval(b1,b2), \nP(b1,b2,pIXf) P(b1,b2,p). 2.Letgbeanotheronstraintfuntiononpatternin\u00adstanesofp,thenforanytimeinterval(b1,b2), \nP(b1,b2,(pIXf)IXg)= P(b1,b2,pIX(Au.(fu)++(gu))). Followed-byCompositionAninstaneofthepattern p1\u00bbp2isobtainedbyomposinganinstaneofp1with \nanotherofp2suhthatbothinstanesmeetatonepoint. Thefuzzyvalueofthenewinstaneistheminimumofthose ofitsomponents.Aset\u00adtheoretidefnitionofthe(\u00bb) \noperationisasfollows: P(b1,b2,p1\u00bbp2)= {(fbyin1in2v)I in1EP(b1,b2,p1)1in2EP(b1,b2,p2)1 (last(lmsin1))=(head(lmsin2))1 \n(v1=fuzzyin1)1(v2=fuzzyin2)1 v=minv1v2}. Funtionfbyombinesthetwoomponentinstanesoffollowed\u00adbyoperationtoyieldafollowed\u00adbyinstane.Itisdefnedas \nfollows: fby::Patt-Patt-Fuzzy-Patt fbyp1p2v= ase(p1,p2)of (Fbs1v1,Fbs2v2)-Fb(s1++s2)v (Fbs1v1,p2)-Fb(s1++[p2])v \n(p1,Fbs2v2)-Fb(p1:s2)v (p1,p2)-Fb[p1,p2]v Sineafollowed\u00adbyinstanemaintainsalistofomponents thathavebeenomposedbyfollowed\u00adbyoperations,the(\u00bb) \noperationisthereforeassoiative.Formally, TheHaskellfuntion++onatenatestwolists. PROPERTY2.Letp1,p2andpbethreepatterns.For \nanytimeinterval(b1,b2), P(b1,b2,(p1\u00bbp2)\u00bbp)=P(b1,b2,p1\u00bb(p2\u00bbp)). OverlayCompositionAninstaneofthepatternp1 \n<>p2isobtainedbyomposinganinstaneofp1with anotherofp2suhthatbothinstanesmeetatboththe startandtheendpoint.Again,thefuzzyvalueofthenew \ninstaneistheminimumofthoseofitsomponents.Aset\u00adtheoretidefnitionofthe(<>)operationisasfollows: P(b1,b2,p1<>p2)= \n{(overlayin1in2v)I in1EP(b1,b2,p1)1in2EP(b1,b2,p2)1 (head(lmsin1))=(head(lmsin2))1 (last(lmsin1))=(last(lmsin2))1 \n(v1=fuzzyin1)1(v2=fuzzyin2)1 v=minv1v2}. Funtionoverlayombinesthetwoomponentinstanesof anoverlayoperationtoyieldaoverlayinstane.Itisdefned \nasfollows: overlay::Patt-Patt-Fuzzy-Patt overlayp1p2v= ase(p1,p2)of (Ovrs1v1,Ovrs2v2)-Ovr(s1++s2)v (Ovrs1v1,p2)-Ovr(s1++[p2])v \n(p1,Ovrs2v2)-Ovr(p1:s2)v (p1,p2)-Ovr[p1,p2]v  Justlikethe(\u00bb)operation,(<>)operationpossessesthe assoiativeproperty: \nPROPERTY3.Letp1,p2andpbethreepatterns.For anytimeinterval(b1,b2), P(b1,b2,(p1<>p2)<>p)= P(b1,b2,p1<>(p2<>p)). \n 7. PATTERN REUSABILITY ForCPLtobeaeptabletothefnanialanalysts,it isneessarytoprovidealibraryofommonly\u00adusedpat\u00adterns.Therefore,reusabilityofpatternsbeomesruialas \nusersmaywanttorefneandomposetheselibrarypatterns. Itisunreasonableforuserstobeundulyonernedabout theexatsequeneofsub\u00adomponentsinthepatterndef\u00adnition.Usersshouldbeabletoaessthelandmarksand \nsub\u00adomponentsofapatterninastandardorder,regardless oftheexatsequeneofompositionofthepattern. Forexample,onsidertheuseofadiamondpatternal\u00adreadydefnedinthesystemlibrary.Whiletheuserisaware \nofthefatthatadiamondisomposedofoverlayingtwo resistanelinesontwosupportlines,heshouldnotbeon\u00adernedofwhetherthediamondisonstrutedby \n(res\u00bbres)<>(sprt\u00bbspt) or (sprt\u00bbsprt)<>(res\u00bbres) However,thesetwoompositionswillproduediferentor\u00adderingoflandmarksandomponents,iftheuserwereto \naessthemvialmsandsubfuntions.Tooveromethis problem,weproposeastandardorderingforomponent\u00adpatterninstanesandlandmarks. \nNotethatthisproblemdoesnotourinaseoffollowed\u00adbyoperation.Theorderingthelandmarksandsub\u00adomponents ofafollowed\u00adbyinstaneisalwaysfromlefttorightor \ninotherwordsinhronologialorderoftheirourrene. Therefore,wefousonorderingtheomponentsandland\u00admarksofoverlaypatternsonly. \nNext,weobservethatonetheomponent\u00adpatternin\u00adstanesareproperlyordered,landmarkorderingproblem willnolongerexist.Inotherwords,havingastandardor\u00adderingontheomponentsissu\u00c6ienttoensureastandard \norderingonthelandmarks.Consequently,werestritour attentiontotheorderingofomponent\u00adpatterninstanes only. \nSo,exatlywhatonstitutesagoodorderingofomponent\u00adpatterninstanes?Webelievethatagoodorderingisone thatanbedetermineduniquelyfromthepatterndefni\u00adtion,notthepatterninstane.Byfxinganorderingona \npattern,wetreatallitsinstanesinauniformway. Thus,wedefneanorderingoverpatterninstanesasfol\u00adlows: DEFINITION2(PATTERNINSTANEORDERING). \n1.Patterninstanesareorderedbasedontheirdataon\u00adstrutors,asfollows:Bar<Res<Up<Hor< Down<Sprt<Fb<Ovr. 2.Twoompositeinstaneswiththesamedataonstru\u00adtorareorderedbylexiographiorderingoftheirlists \nofomponents. 3.Otherwise,twopatterninstanesareofequalorder. Forexample, (Res(2,10)10.4)<(Up(4,5)0.6)<(Fb[..]0.3) \n(Fb[Res(2,5)1.50.4,..]0.2)< (Fb[Sprt(1,5)0.50.3,..]0.15) InCPL,wehaveabuilt\u00adinfuntionorderPatwhihtakes \napatterninstaneandreturnsanewinstanesuhthat sub\u00adomponentsofitsoverlayomponentsarereursively orderedaordingtothisrule.orderPatisdefnedasfollows: \norderPat::Patt-Patt orderPatp= asepof (Fbpsv)-Fb(maporderPatps)v (Ovrpsv)-orderOvrp otherwise-p whereorderOvr(Ovrpsv)= \nletps1=maporderPatps ps2=sortByovrOrderps1 inOvrps2v HaskellfuntionsortBytakesaomparisonfuntionanda \nlistofdata,andsortsthelistusingtheomparisonfuntion. ovrOrderistheomparisonfuntiondefnedaordingto Defnition2.Thedetailisomitted. \nAsanexample,onsiderapplyingorderPattothefollow\u00adingpatterninstanes(weshoweahomponentbyitsdata onstrutorsonly): \nOvr[Fb[Res,Ovr[Up,Sprt]],Fb[Res,Ovr[Down,Res]]] Theresultingpatterninstaneisoffollowingstruture: Ovr[Fb[Res,Ovr[Res,Down]],Fb[Res,Ovr[Up,Sprt]]] \n Notiethatintheresultingpatterninstane,theompo\u00adnentsofalltheoverlaysub\u00adpatternsfollowthepatternin\u00adstaneordering. \nNow,forourdiamondexample,nomatterhowdmndis defned,theuseranreusethepatternasfollows: dmndIXAu.letu . \n=orderPatu [rs,ss]=subu . in... Thereisanotheradvantagefororderingtheomponents basedonpatternformationratherthanpatterninstanes: \nItenablestheorderinginformationtobelargelyomputed atompiletime. ItshouldbenotedthatorderPatdoesnotworkinthe \nfollowingases: 1.Itannotordertwoinstaneswhihareequalunder patterninstaneordering.Forinstane,patternin\u00adstanesonstrutedbythesameomponentpatterns \nbutdiferentonstraintfuntionswillnotbeuniquely ordered. 2.Itmayproduediferentorderingfordiferentpattern \ninstanesofadynamipattern.Forexample,instanes ofthefollowingpatternsannotbeuniquelyordered: (if...thenreselsesprt)andup. \n Forthosepatternswithambiguousordering,userhasto knowhowtheyareonstrutedtouselmsandsubopera\u00adtions. 8. \nIMPLEMENTATION Thereareabundantopportunitiesfore\u00c6ientimplemen\u00adtationofCPL.Forexample,onsiderevaluatingthepattern \n(p1\u00bbp2)withthetimebound(b1,b2).Followingisthe possiblestepsinvolvedduringimplementation: 1.Findallinstanesofpatternp1andallofp2thatour \nbetweenthebound[b1,b2]. 2.Findallpairsofinstanesofp1andinstanesp2that satisfythesemantisof(\u00bb);i.e.,theyjoinatapoint. \n Anaiveapproahtoimplementtheseondstepistouse nestedloops.Inotherwords,foreahp1\u00adinstane,hek theentirelistofp2\u00adinstanestoidentifythosewhihjoin \nproperlywiththisp1\u00adinstane.Theomplexityforthisap\u00adproahisO(n*m),wherenandmarenumbersofp1\u00adandp2\u00adinstanesfoundinstep(1)respetively. \nTheperformaneanbeimprovedsignifantlyifwean ensurethatlistsofp1\u00adandp2\u00adinstanesaresortedontheir startingpoints(f.[14]).Formally,foranytwopattern \ninstanesaandbthatspanoverthetime(as,ae)and(bs,be) respetively,wesaythata<bwheneither(as<bs)or (as =bs1ae<be).Inourase,wedonothavetospend \nextraeforttosortthelists,aswejusthavetoensurethat p1andp2areevaluatedininreasing\u00adtimeorder.Withtwo sortedlistofinstanes,fndingpairswhihhaveproperjoin \nbeomesamergingproess,whihisomputationallyless expensivethanthenaiveapproah. Therearetwosimpleobservationsthatmakemergingap\u00adproahe\u00c6ient,andfurthermoreamenabletolazyevalua\u00adtion.Letthefrstelementinthelistofp1\u00adinstanesspans \noverthetime(as,ae). 1.Allinstanesofp2thatstartbeforethetimeasannot bejoinedwithanyoftheinstanesofp1thatareyetto \nbeproessedinthelist.Theseuselessinstanesanbe exemptedforpairingonsideration.Underlazyevalu\u00adation,theseinstaneswillnotbeonstrutedfully. \n2.Onlythosep2\u00adinstanesthatstartataeanproperly joinwiththeexistingp1\u00adinstane.So,sanningofthe seondlistwillhaltimmediatelywhenap2\u00adinstane \nthatstartsatatimebeyondaeisenountered.Again, underlazyevaluation,therestoftheinstanesneeds notbegenerateduntiltheyareneeded. \nInadditiontothesort\u00adand\u00admergeapproah,e\u00c6ienyan befurtherimprovedifweusemoreadvaneddatastru\u00adturesinsteadofliststostorepatterninstanes.Werefer \nthereaderto[4]fordetails. 9. RELATED WORK CPLisaprogramminglanguageforspeifyinggeometri\u00adalpatternsintime\u00adseriesdatabases.InCPL,patternsare \nspeifedusingsyntationstraints(intermsofprimitive patterns)andsemantionstraints(intermsofasetofon\u00adstraints).Onitsown,syntatipatternspeifationandits \nreognitiontehniqueshavebeenstudiedextensivelyin[9]. Here,patternsaredesribedusingsomeprimitivepatterns, \nandthereognitiontehniquestranslatestheentirepattern intoastringoftokens(primitiveurves)formathing. ThesyntationstraintofCPLisrelatedtotheShape \nDesriptionLanguage(SDL)proposedbyAgrawaletal.[2]. InSDL,patternsaredesribedintermofprimitiveslikeup, \ndown,stable,et.,eahofwhihareonetime\u00adunitlong. Patternsanthenbeomposedfromtheseprimitivesinthe formofregularexpressions.SDLdoesnothandleoverlay \npatterns.Furthermore,itsufersfromthefollowinglimita\u00adtions:Firstly,SDLtakesamirosopiapproahindefning patterns.Assuh,itisdi\u00c6ulttoexpressinSDLtheglobal \nfeaturesofapatternusingtheseprimitives,whihareloal innature.Forexample,atrianglepatternisformedbya pairofsupportandresistaneline,ignoringthesmallfu\u00adtuationswithinthoseline.Defningtriangleusingabovemi\u00adrosopiprimitivesanbeomeaomplextask.Seondly, \nCPLhasastrongsupportforreatingindiatorsandusing theminpatterndefnitions.AnIndiatorisatuallyanew timeseries(eg.movingaverage)reatedoutofrawatime \nserieslikelosingpries.Soitisveryusefultobeableto defnepatternsnotonlyontherawtimeseries,butanew transformedseriesreatedoutofit.SDLdoesnothavesuh \nafaility. ThesemantionstraintsofCPLareinspiredbytheland\u00admarkmodelproposedbyPerngetal.forsimilarity\u00adbased \npatternmathing[17].Briefy,thismodelisbuiltfromstudy ofhumanvisualsystem,whihfndsthatmuhofthevisual datapereivedbyhumanbeingisredundant;somedom\u00adinantpointsontheshapeontourarerihininformation \nontent,andaresu\u00c6ienttoharaterizeashape[6,11]. Consequently,wedefnelandmarksinapatterntobethose pointshavingimportantshapeattributes;i.e.,thosethat \nformthejointsoftheskeletonofapattern.Byproviding onstraintonthelandmarks,patternsanbedefnedfrom amarosopilevel,ignoringunneessarydetails. \nOurhoieofpattern\u00adompositionoperationsallowsus tosupportinterval\u00adbasedtemporalreasoningofpriehis\u00adtory.Theseoperationsareloselyrelatedtothosedefned \ninAllen'salgebraformodelingtimesandevents[3].Allen's algebra(aswellasitsassoiatedoperators)hasbeenused \nwidelyindevelopingquerylanguagesfortemporaldatabases, suhasTQUEL[20],TSQL[16],et.However,theselan\u00adguagesmainlytranslateAllen'soperationsintopoint\u00adbased \ntemporalquery;theydonotmakefulluseofinterval\u00adrelated temporalpropertiesintheirimplementation.Ontheother \nhand,CPLaspresentedsofaronlysupportstwoofthe Allen'soperators;weareurrentlyextendingCPLtofully supportAllen'soperators. \nLastly,wehavemodeledtehnialindiatorsasfuntions, similartoBehaviorsinFran[S]andObservablesinthework onFinanialontrat[1S].Sinetehnialindiatorsoperate \nonhistorydataofaseurity,whihanbeviewedasalist ofdata,itispossibletomodelindiatorsasoperationsover infnitestreams,asinLUSTRE[10].However,thetreatment \nofpatternsasillustratedinthispapershowsthatweusually workonafniteperiodoftime,andmanyoperationssuh asaessingapattern'slandmarkdonotaesshistory \ndatainhronologialorder. 10. CONCLUSION CPLisasimple,yetexpressivelanguagefordefninghart patterns.Itimprovesoverpreviousworkinthisareainthe \nfollowingaspets: 1.Itprovidesahigh\u00adlevelplatformuponwhihanalysts andefneandsearhpatternseasilywithoutmuh \nprogrammingexpertise;thisisdiferentfromworks inneuralnetworkwhihtreatthepatterndisovery proessasablakbox[12]somethingthattheuser \nanbeunomfortablewith. 2.Itsspeifationislosetohowanalystswoulddesribe thepatternsinhumanterms,butwithoutompromis\u00adingonpreision. \n3.Itallowstodefnenewtehnialindiatorsanduse theminpatterndefnitionstospeifyonstraints.This allowsaneasyandelegantwaytospeifyonstraints \nandreusethem. WehavebuiltaprototypeforCPLembeddedinHaskell. Makinguseoflazyevaluation,thesystemperformsreason\u00adablywell.Forexample,ittakeslessthan2seondstore\u00adtrieveallthehillpatterninstaneswithinadailypriehis\u00adtoryoftwoyears.Variousperformaneoptimizationteh\u00adniquesarestillbeinginvestigated.Theseinludes:las\u00adsifationandloalizationofonstraints,ahingofprimi\u00adtivepatterninstanes,et.Inaddition,programanalysis \nanbeinludedtoenhanetherobustnessofCPLprogram\u00adming.Forexample,sizedtypeinferene[7]anhelpinfer thenumberoflandmarksassoiatedwithapattern.This \nanprovideastatihekonthesizeoflistreturnedbythe lmsoperation.Weplantoextendourlanguagetosupport automatitradingdeisionsbyspeifyingtradingstrategies \nusingpatterns.CurrentlywearebuildingaGUIforthesys\u00adtem;thiswillthenenableustoviewtheresultingpattern instanesvisually. \n11. ACKNOWLEDGMENT WewouldliketothankCharlesConselandhisCOM\u00adPOSEgroupfordisussionondomain\u00adspeiflanguage.We \nalsothanktheanonymousrefereesfortheirinsightfulom\u00admentsandvaluablesuggestions.Thisworkwassupported bytheresearhgrantRP3991623andRP39S2693. \n 12. REFERENCES [1]S.B.Ahelis.TehnialAnalysisAtoZ.MGraw\u00adHill Professional,19S2. [2]R.Agrawal,G.Psaila,E.L.Wimmers,andM.ZaYt. \nQueryingShapesofHistories.InUmeshwarDayal, PeterM.D.Gray,andShojiroNishio,editors, VLDB'95,Proeedingsof21thInternational \nConfereneonVeryLargeDataBases,September 11-15,1995,Zurih,Switzerland,pages502 514. MorganKaufmann,1995. \n[3]J.Allen.Towardsageneraltheoryofationandtime. ArtifialIntelligene,23:123 154,19S4. [4]SaswatAnand.Domain\u00adSpeifLanguagefor \nFinanialForeasting,2001.MSThesis, Forthoming. [5]N.Bulkowski.EnylopediaofChartPatterns.John WileyandSons,19S2. \n [6]K.ChengandM.Speth.Mehanismsoflandmark useinmammalsandbirds.SpatialRepresentationin Animals,199S. \n[7]W.N.ChinandS.C.Khoo.Calulatingsizedtypes.In 2000ACMWorkshoponPartialEvaluationand Semantis-BasedProgramManipulation,pages62 \n72, Boston,Massahusetts,UnitedStates,January2000. [S]C.ElliotandP.Hudak.FuntionalReative Animation.InACMSIGPLANInternational \nConfereneonFuntionalProgramming(ICFP'97), pages263 273,Amsterdam,Holland,August1997. ACMPress. [9]K.S.Fu.SyntatiPatternReognitionand \nAppliations.EnglewoodClifs,19S2. [10]N.Halbwahs,P.Caspi,P.Raymond,andD.Pilaud. Thesynhronousdatafowprogramminglanguage \nLUSTRE.ProeedingsoftheIEEE,79(9):1305 1320, 1993. [11]M.Humphreys,J.Wiles,andS.Dennis.Towardsa theoryofhumanmemory:Datastruturesandaess \nproesses.BehavioralandBrainSienes,17(4),1994. [12]K.KamijoandT.Tanigawa.Stokpriepattern reognition\u00adareurrentneuralnetworkapproah.In \n1990InternationalJointConfereneonNeural Networks,pagesI215 222,1990. [13]G.J.KlirandB.Yuan.FuzzysetsandFuzzyLogi: \nTheoryandAppliations.PrentieHallPTR,1995. [14]T.Y.LeungandR.Muntz.Queryproessingfor temporaldatabases.InProeedingsofthe6th \nInternationalConfereneonDataEngineering,Los Angeles,California,1990. [15]GaryMeehanandMikeJoy.Animatedfuzzylogi. \nJournalofFuntionalProgramming,S(5):503 525, September199S. [16]S.B.NavatheandR.Ahmed.TSQL\u00adALanguage InterfaeforHistoryDatabases.InC.Rolland, \nF.Bodart,andM.Leonard,editors,TemporalAspets inInformationSystems,pages113 12S. North\u00adHolland/IFIP,Amsterdam,TheNetherlands, \n19S7. [17]C.Perng,H.Wang,S.R.Zhang,andS.Parker. Landmarks:Anewmodelforsimilarity\u00adbasedpattern queryingintimeseriesdatabases.InPro.16th \nInternationalConfereneonDataEngineering.,2000, pages33 42,2000. [1S]S.L.PeytonJones,J.Eber,andJ.Seward.Composing \nContrats:AnAdventureinFinanialEngineering.In ACMSIGPLANInternationalConfereneon FuntionalProgramming(ICFP'00),pages2S0 \n292, Montreal,Canada,September2000.ACMPress. [19]S.L.PeytonJones,R.J.M.Hughes,L.Augustsson, D.Barton,B.Bontel,W.Burton,J.Fasel, \nK.Hammond,R.Hinze,P.Hudak,T.Johnsson,M.P. Jones,J.Launhbury,E.Meijer,J.Peterson,A.Reid, C.Runiman,andP.L.Wadler.Reportonthe \nProgrammingLanguageHaskell9S.Tehnialreport, February199S. [20]RihardSnodgrass.TheTemporalQueryLanguage \nTQUEL.ACMTransationsonDatabaseSystems, 12(2):247 29S,19S7.  \n\t\t\t", "proc_id": "507635", "abstract": "It is an established notion among financial analysts that price moves in patterns and these patterns can be used to forecast future price. As the definitions of these patterns are often subjective, every analyst has a need to define and search meaningful patterns from historical time series quickly and efficiently. However, such discovery process can be extremely laborious and technically challenging in the absence of a high-level pattern definition language. In this paper, we propose a chart-pattern language (CPL for short) to facilitate pattern discovery process. Our language enables financial analysts to (1) define patterns with subjective criteria, through introduction of fuzzy constraints, and (2) incrementally compose complex patterns from simpler patterns. We demonstrate through an array of examples how real life patterns can be expressed in CPL. In short, CPL provides a high-level platform upon which analysts can define and search patterns easily and without any programming expertise. CPL is a domain-specific language embedded in Haskell. We show how various features of a functional language, such as pattern matching, higher-order functions, lazy evaluation, facilitate pattern definitions and implementation. Furthermore Haskell's type system frees the Programmers from annotating the programs with types.", "authors": [{"name": "Saswat Anand", "author_profile_id": "81542667856", "affiliation": "National Univ. of Singapore", "person_id": "P345494", "email_address": "", "orcid_id": ""}, {"name": "Wei-Ngan Chin", "author_profile_id": "81100655104", "affiliation": "National Univ. of Singapore", "person_id": "PP39052727", "email_address": "", "orcid_id": ""}, {"name": "Siau-Cheng Khoo", "author_profile_id": "81100241361", "affiliation": "National Univ. of Singapore", "person_id": "PP39034080", "email_address": "", "orcid_id": ""}], "doi_number": "10.1145/507635.507653", "year": "2001", "article_id": "507653", "conference": "ICFP", "title": "Charting patterns on price history", "url": "http://dl.acm.org/citation.cfm?id=507653"}