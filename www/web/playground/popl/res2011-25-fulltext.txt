vector addition system reachability problem a short proof de abstract the reachability problem for vector addition systems is a central problem of net theory the general problem is known decidable by algorithms exclusively based on the classical decomposition decomposition recently from this decomposition we that a final configuration is not reachable from an initial one if and only if there exists a presburger inductive invariant that contains the initial configuration but not the final one since we can decide if a formula denotes an inductive invariant we deduce from this result that there exist certificates of in the presburger arithmetic in particular there exists a simple algorithm for deciding the general reachability problem based on two a first one that tries to prove the reachability by finite sequences of actions and a second one that tries to prove the by presburger formulas in this paper we provide the first proof of the reachability problem that is not based on the decomposition the proof is based on the notion of production relations inspired from that directly provides the existence of presburger inductive invariants categories and subject descriptors d software engineering formal methods d design tools and techniques petri nets general terms theory verification keywords petri presburger reachability introduction vector addition systems or equivalently petri nets are one of the most popular formal methods for the representation and the analysis of parallel processes en the reachability problem is central since many computational problems even outside the parallel processes reduce to the reachability problem and provided in st a partial proof of decidability of this problem the proof was completed in by may and simplified by from st may ten years later lam provided a more simplified version based on this last proof still remains difficult and the complexity of the corresponding algorithm is just known permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission andor a fee popl january ­ austin texas usa copyright c acm recursive the exact complexity of the reachability problem for is still an even an elementary complexity is open in fact the known general reachability algorithms are exclusively based on the decomposition recently we proved thanks to the decomposition that parikh of languages accepted by are a class that extends the presburger sets an application of this result was provided we proved that a final configuration is not reachable from an initial one if and only if there exists a forward inductive invariant definable in the presburger arithmetic that contains the initial configuration but not the final one since we can decide if a presburger formula denotes a forward inductive invariant we deduce that there exist certificates of in the presburger arithmetic in particular there exists a simple algorithm for deciding the general reachability problem based on two a first one that tries to prove the reachability by finite sequences of actions and a second one that tries to prove the by presburger formulas in this paper we provide a new proof of the reachability problem that is not based on the decomposition the proof is based on the production relations inspired by and it provides directly that reachability sets are sets a class of sets introduced in this paper that extend the class of presburger sets and contained in the class of sets in particular this paper provides a more precise characterization of the reachability sets of outline of the paper section provides notations and classical definitions section and section introduce classes of sets used in the sequel sets and vector spaces in the first one and periodic sets presburger sets sets and petri sets in the second one section and section show that it sufficient to prove that the reachability relation of a vector addition system is a petri relation in order to deduce the existence of forward inductive invariants definable in the presburger arithmetic proving the in section we introduce the class of vector addition systems and the central notion of production relations we show in the next section that these relations are periodic in section we prove that the reachability relation of a vector addition system is a petri relation finally in section we combine all the previous results to deduce the decidability of the vector addition system reachability problem based on presburger inductive invariants notations we introduce in this section notations and classical definitions used in this paper we denote by n n z q q q the set of natural num positive integers integers rational numbers non negative ra tional numbers and positive rational numbers vectors and sets of vectors are denoted in face the ith component of a vector v qd is denoted by vi we introduce v vi where vi is the absolute value of vi the total order over q is extended into an order over the set of vectors qd the addition function is also extended over qd given two sets v v qd we denote by v v the set v v v v v × v and we denote by v v the set v v v v v × v in the same way given t q and v qd we let t v tv t v t × v we also denote by v v and v v the sets v v and v v and we denote by tv and t v the sets tv and t v in the sequel an empty sum of sets included in qd denotes the set reduced to the zero vector a binary relation r over qd is a subset r qd × qd the composition of two relations r and s is the relation denoted by r s and defined as usual by the following equality rs n x z d q × d q x y r o y z s the reflexive and transitive closure of a relation r is denoted by r in this paper notions introduced over the sets are over the relations by identifying qd × qd with qd an order over a set s is said to be well if for every sequence of elements sn s we can extract a subsequence that is for ie there exists a strictly increasing sequence of natural numbers in n such that kn is non decreasing for a minimal element of an ordered set s is an element s s such that for every t t the relation t s implies s t given a set y s we denote by min y the set of minimal elements of the ordered set y let us recall that if s is well ordered then x min y is finite and for every y y there exists x x such that x y let us consider an order over a set s we introduce the extension of over the set of vectors sd defined by s t if si ti for every i d lemma lemma the ordered set sd is well for every well ordered set s example the set n is well ordered hence nd is also well ordered the set z is not well ordered sets in this section we introduce the sets and we provide a characterization of this class based on the vector spaces a set is a set c qd such that c c c c and such that qc c a set c is said to be finitely generated if there exists a finite sequence c ck of vectors cj c such that c qc · · · definition a set c is said to be if it is definable in fo q example the set c c q c c is not example the set c q is but it is not finitely generated a vector space is a set v qd such that v v v v and such that qv v let x qd the following set is a vector space called the vector space generated by x k x v j xj k n and j xj q × x j observe that this vector space is the minimal for the inclusion vector space that contains x note that the vector space v generated by a set c satisfies the equality v c c let us recall that every vector space v is generated by a finite set x with at most d vectors the rank of a vector space v is the minimal natural number r d such that there exists a finite set x with r vectors that generates v note that for every vector spaces v w moreover if v is strictly included in w then the topological closure of a set x qd is the set x of vectors r qd such that for every q there exists x x satisfying r x a set x is said to be closed if x x note that x is closed and this set is the minimal for the inclusion closed set that contains x let us recall that a vector space v is closed and the closure of a set is a set since the classical topological interior of a set c is empty when the vector space generated by c is not equal to qd the set is we introduce the notion of interior of c relatively to the vector space v c c more precisely a vector c c is said to be in the interior of c if there exists q such that c v c for every v c c satisfying v we denote by the set of interior vectors of c let us recall that is non empty for every set c and c c if and only if for every sets c c the following lemma characterizes the finitely generated it proves that finitely generated sets are lemma let v qd be a vector space a set c v is finitely generated if and only if there exists a sequence of vectors v such that k d x c v v j i moreover in this case the following equality holds if and only if v is the vector space generated by c k d x v v j i proof this is a classical result of duality theorem a set c qd is if and only if the set c v is finitely generated for every vector space v qd proof let us first consider a set c qd let v be a vector space and let us prove that x is finitely generated where x c v since v is generated by a finite set we deduce that v and in particular x are definable in fo q since this logic admits quantification elimination we deduce that there exists a quantifier free formula in this logic that denotes x hence there exists a finite sequence of finite sets aj qd × × q such that x sk j xj where d xj x d q x i we can assume without loss of generality that xj is non empty let us introduce the following set rj d rj x d q x i lemma shows that rj is finitely generated in particular r pk j rj is finitely generated thanks to lemma we deduce that r is closed we are going to prove that x r let us first consider x x for every n n we have nx x since x is a set hence there exists j k such that nx xj for an infinite number of n n we deduce that x rj thus x r and we have proved that x r by of the closure of x for the converse inclusion let r r there exists a sequence rj jk of vectors rj rj such that r pk j rj since xj is non empty there exists xj xj as rj rj we deduce that xj xj hence x pk j x where x pk j xj in particular x qr x we deduce that for every q we have x r x therefore r x we have proved the other inclusion thus x r is finitely generated conversely we prove by induction over r that the sets c qd such that c r and such that the set c v is finitely generated for every vector space v qd are the case r is immediate since in this case c let us assume the induction proved for an integer r n and let us consider a set c qd such that c r and such that the set c v is finitely generated for every vector space v qd we introduce the vector space w c c since c c v with v qd we deduce that c is finitely generated lemma shows that there exists a finite sequence of vectors w such that the following equality holds k d x c x w j i since we get the following equality k d x w x j i in particular is definable in fo q as c c we deduce the following decomposition where wj w w pd i k c c wj j observe that and in particular wj is strictly included in w thus r note that cj c wj is a set such that cj r and such that cj v is a finitely generated set for every vector space v thus by induction cj is definable in fo q we deduce that c is we have proved the induction presburger sets sets and petri sets in this section we introduce the presburger sets sets and petri sets a periodic set is a subset p zd such that p and such that p p p a periodic set p is said to be finitely generated if there exists a finite sequence p pk of vectors pj p such that p np · · a subset s zd is called a presburger p p p p p p figure a periodic set set if it can be denoted by a formula in the presburger arithmetic fo z let us recall gs that a subset s zd is presburger if and only if it is a finite union of sets b p where b zd and p zd is a finitely generated periodic set the class of sets is obtained by weakening the property of the periodic sets p definition a periodic set p is said to be if the set qp is remark every finitely generated periodic set p is since in this case qp is a finitely generated set and in particular a set example the periodic set p p n p p is not example the periodic set p p n p p p is represented in figure observe that qp c q p p is a set thus p is a periodic set the following lemma shows that the class of periodic sets is stable by finite intersections lemma we have qp qp qp p for every periodic sets p p zd proof observe that p qp and p qp hence p p c where c qp qp as c is a set we deduce that c for the converse inclusion let c c since c qp there exists q such that c p there exists q such that c p let n n n such that n n and n n let n nn and observe that nc p since p is a periodic set nc p we have proved that nc p p thus c qp p and we get the other inclusion sets and petri sets are central in this paper definition a set l zd is a finite union of sets b p where b zd and p zd is a periodic set definition a petri set is a subset x zd such that x s is a set for every presburger set s zd example let us consider the periodic set p n n n n observe that qp is the set q we deduce that p is a set note that p is not a petri set since p n × n n n is not a set the class of petri sets is between the class of presburger sets and the class of sets the previous example shows that the class of petri sets is strictly included in the class of sets the strict inclusion of the class of presburger sets into the class of petri sets will be a direct consequence of a stronger result proved in this paper in fact the reachability relation of a vector addition system is proved to be a petri relation and we know that in general such a relation is not presburger the linearization of a periodic set p zd is the periodic set defined by the following equality p p qp lemma the linearization of a periodic set is finitely generated proof let v be the vector space generated by p and let us in the set c qp note that qp v and since v is closed we get c v as qp is a set we deduce that c is finitely generated hence there exists c ck c such that c qc · · · as cj c v qp qp by replacing cj by a vector in we can assume that cj p p for every j k we introduce the following set r k x r r p p r j q j j we observe that every vector r r satisfies r s where s pk j cj hence r s sd and we deduce that r is finite let l be the periodic set generated by the finite set r c ck since this finite set is included in we de that l let us prove the converse inclusion let x since x c there exists a sequence of rational elements q such that x pk j cj let us introduce nj n such that j nj satisfies j let r pk j j cj as r x pk j nj cj we get r p p thus r r from x r pk j nj cj we get x l we have proved that l is finitely generated we observe that if the intersection b p b p is empty where b b zd and p p zd are two periodic sets then the intersection b b may be non empty in this section we show that a dimension is strictly decreasing let us first introduce our definition of dimension the sion of a nonempty set x zd is the minimal r d such that there exists k n a sequence bj jk of vectors bj zd and a sequence vj jk of vector spaces vj qd such that r and such that x sk j bj vj the dimension of the empty set is defined by in the of this section we prove the following theorem all other results or definitions introduced in this section are not used in the sequel theorem let b b zd and let p p be two periodic sets such that the intersection b p b p is empty the intersection x b b satisfies p p we first characterize the dimension of a periodic set lemma let v be the vector space generated by a periodic set p then proof let p be a periodic set and let us first prove by induction over k n that p sk j vj implies that there exists j k such that p vj for every sequence of vector spaces vj qd the case k is immediate assume the property proved for an integer k n and let us assume that p sk j vj if p vk the property is proved so we can assume that there exists p let us prove that p sk j vj we consider x p observe that if x vk then x sk j vj so we can assume that x vk we observe that p nx p for every n n since the set p is periodic we deduce that there exists j k such that p nx vj naturally this integer j depends on n however since k is finite whereas n is infinite there exists j k and n n in n such that p nx and p n x are both in vj as vj is a vector space we deduce that n p nx np n x is in vj hence p vj as p vk we deduce that j k as vj is a vector space we deduce that p n x p nx vj hence x vj we have proved that x sk j vj thus p sk j vj and by induction there exists j k such that p vj we have proved the induction now let us prove the lemma we consider a periodic set p and we let v be the vector space generated by this set since p v we deduce that for the converse inclusion since p is non empty we deduce that p sk j bj vj where k n bj zd and vj qd is a vector space such that let us consider the set j j k bj vj and let us prove that p s jj vj let p p and n n since np p there exists j k such that np bj vj hence there exists j k and n n in n such that np and n p are both in bj vj as vj is a vector space we deduce that n p np vj thus p vj moreover as bj np vj vj we deduce that j j we have prove the inclusion p s jj vj from the previous we deduce that there exists j j such that p vj by of the vector space generated by p we get v vj hence since we have proved the inequality next we prove a separation property lemma let c and c be two finitely generated sets that generates the same vector space v and such that the vector space generated by c c is strictly included in v then there exists a vector h v such that for every we have d c v v x i proof lemma shows that there exists two finite sets h h included in v such that d c v v x hh i d v v x hh i assume by contradiction that the intersection is non empty and let c be a vector in this set observe that there exists q such that c v c c for every v v such that v we deduce that the vector space generated by c c contains v and we get a contradiction we deduce that the following intersection is empty where h h h d v v x hh i the lemma shows that there exists a non zero function f h q such that p hh f hh let us introduce a p hh f hh and b p f hh assume by contradiction that a since a b we deduce that b as f is not the zero function there exists h h such that f h note that either h h or h hh in the first case we deduce that is empty and in the second case we deduce that is empty since both cases are impossible we get a contradiction thus a for every c we have pd i since the set c qd pd i is closed we deduce that for every c c the same inequality holds now let us consider c in this case pd i since a b we get pd i we deduce that this inequality holds for every c c remark the previous lemma is wrong if we remove the finitely generated condition on the sets c and c in fact let us consider the sets c x q x x and c x q x x observe that c c hence the vector space generated by the intersection is strictly included in q however there does not exist a vector a q satisfying the separation property required by lemma this problem can be overcome by introducing the vector spaces of rd we do not introduce this extension to simplify the presentation we can now provide a proof of theorem we consider two vectors b b zd and two periodic sets p p zd such that b p b p we introduce the intersection x b b observe that if x is empty the theorem is proved so we can assume that there exists a vector b in this intersection let us denote by v and v the vector spaces generated by p and p lemma shows that and from pj we deduce that pj as x is included in bv where v v v we deduce that if v is strictly included in vj for one j then pj and the theorem is proved so we can assume that v v v let us consider the sets c qp and c qp since p and p are periodic sets we deduce that c and c are finitely generated sets note that c c v we introduce the intersection c c c assume by contradiction that the vector space generated by c is equal to v let us consider a vector c in the interior of c the characterization given by lemma shows that in this case since we deduce that c qp qp lemma shows that c qp p by replacing c be a vector in nc we can assume that c p p let us prove that there exists k n such that b kc b p from b b we deduce that there exists p p p such that b b p p since p is in the vector space generated by c and c is in the interior of c there exists n n large enough such that nc p c hence there exists n n such that np p thus p n p p p hence b kc b p with k nn we deduce that there exists k n such that b kc b p we have proved that b k kc b p b p and we get a contradiction since this intersection is to be empty we deduce that the vector space generated by c is strictly included in v lemma shows that there exists a vector h v such that d c v v x i d x c v v i by replacing h by a vector in we can assume that h zd now let us consider x x since x b c we deduce that pd i bi and since x b c we deduce that pd i bi we introduce the integers z pd i and z pd i we have proved that x can be decomposed into a finite union of slices x sz zz xz where d xz x x x z i let us prove that if xz is empty the relation is immediate if xz is non empty let us consider x xz and observe that xz x w where d w v v x i note that h vw we deduce that w is strictly included in v and in particular hence from x sz zz xz and for every z we deduce that and the theorem is proved presburger invariants given a relation r over zd and two sets x y zd we introduce the forward image and the backward image defined by the following equalities s xx y zd x y r s yy x zd x y r we say that a set x zd is a forward invariant for r if x and we say that a set y zd is a backward invariant for r if y in the of this section we prove the following theorem all other results or definitions introduced in this section are not used in the sequel theorem let r be a reflexive and transitive petri relation over zd and let x y zd be two presburger sets such that r x × y is empty there exists a partition of zd into a presburger forward invariant that contains x and a presburger backward invariant that contains y we first prove the following lemma lemma the sets and are petri sets for every petri relation r zd × zd and for every presburger sets x y zd proof let us first prove that is a petri set we consider a presburger set s zd observe that x × s is a presburger relation since r is a petri relation we deduce that r x × s is a relation hence this set can be decomposed into a finite union sk j aj bj rj with k n aj bj zd × zd and rj is a periodic relation we deduce that s sk j bj pj where pj v zd u v rj since rj is a periodic relation we deduce that pj is a periodic set moreover since is we deduce that cj v qd u v is let us prove that cj by construction we have pj cj since cj is we deduce that cj for the converse inclusion let v cj there exists u qd such that u v hence there exists q such that u v rj let us consider n n such that nj n and observe that nu nv rj since rj is periodic thus nv pj and we have proved that v hence cj is a set and we have proved that s is a set for every presburger set s zd hence is a petri set from y with r y x x y r we deduce that is a petri set now let us prove theorem we consider a reflexive and transitive petri relation r we introduce the notion of a is a x y of presburger sets such that the intersection r x × y is empty since r is reflexive observe that xy is empty the presburger set d is called the domain of x y let us observe that a x y with an empty domain is a partition of zd such that x is a presburger forward invariant and y is a presburger backward invariant in particular theorem is obtained thanks to the following lemma with an immediate induction lemma let x y be a with a nonempty domain d there exists a x y with a domain d such that x x y y and proof we first observe that a x y of presburger sets is a if and only if x y if and only if x y if and only if y x since r is a petri relation we deduce that x is a petri set as d is a presburger set we deduce that x d is a set hence x d sk j bj pj where bj zd and pj zd is a periodic set we introduce the following presburger set k s bj j observe that x d s we deduce that the set y y ds is such that x y hence x y is a since r is a petri relation we deduce that y is a petri set as d is a presburger set we deduce that y d is a set hence y d sn l cl ql where cl zd and ql zd is a periodic set we introduce the following presburger set n t cl l observe that y d t we deduce that the set x x dt is such that y x hence x y is a let us introduce the domain d of x y we have the following equality where bj cl d d jk ln as x y is a we deduce that y is empty as bj pj x x and cl ql y we deduce that the intersection bj pj cl ql is empty theorem shows that pj ql since bj pj d and cl ql d we deduce that pj and ql we have proved that vector addition systems in this section we introduce the vector addition systems the production relations and a well order over the set of runs of vector addition systems a vector addition system is a finite subset a zd a marking is a vector m nd the semantics of vector addition systems is obtained by introducing for every word w a ak of vectors aj a the relation w over the set of markings defined by x w y if there exists a word m mk of markings mj nd such that x y m mk and mj mj aj for every j k the word is unique and it is called the run from x to y labeled by w the marking x is called the source of and it is denoted by src and the marking y is called the target of and it is denoted by tgt the set of runs is denoted by the reachability relation is the relation denoted by over the set of markings defined by x y if there exists a word w a such that x w y in the sequel we often used the fact that x w y implies x v w y v for every v nd the production relation of a marking m nd is the relation m over nd defined by r m s if m r m s the production relation of a run m mk is the relation defined by the following composition m · · · mk the following lemma shows that is periodic for every run as a composition of periodic relations note that in section we prove that this periodic relation is lemma the relation m is periodic proof let us assume that r m s and r m s since r m s we deduce that r r m s r moreover since r r r mm s s we deduce s that r s m s s therefore we introduce a well order over the set of runs based on the following lemma lemma the following inclusion holds for every run src tgt proof assume that m mk with mj nd and let r s be a in the production relation since this relation is defined as a composition there exists a sequence of vectors vj nd satisfying the following relations with v r and vk s v m v · · · vk mk vk we introduce the vector aj mj mj for every j k since mj aj mj we deduce that mj vj aj mj vj moreover as vj mj vj there exists a word wj a such that mj vj wj mj vj we deduce that the following relation holds m v mk vk therefore m mk v vk is in the reachability relation we introduce the order over the set of runs defined by if the following inclusion holds src tgt src tgt in the of this section we prove the following theorem all other results or definitions introduced in this section are not used in the sequel theorem the order is well the order is proved well thanks to the lemma we first recall this lemma let us consider an order over a set s we introduce the order over the set of words over s defined by u v where u s sk with sj s if there exists a sequence tj jk with tj s and sj tj and a sequence wj jk of words wj s such that v lemma lemma the ordered set s is well for every well ordered set s we associate to every run m mk the word a m ak mk where aj mj mj note that is a word over the alphabet s a × nd we introduce the order over this alphabet by a m a m if a a and m m since a is a finite set and is a well order over nd we deduce that is a well order over s from the lemma the order is well over s we introduce the well order ¢ over the set of runs defined by ¢ if src src and tgt tgt the following lemma provides a useful characterization of this order lemma let m mk be a run and let be another run we have ¢ if and only if there exists a sequence vj jk of vectors in nd such that k where j is a run from mj vj to mj vj proof we introduce the sequence defined by aj mj mj assume first that ¢ since we deduce that wa ak where wj s and mj mj we introduce the sequence vj jk defined by v src src vk tgt tgt and vj mj mj for every j k observe that vj nd for every j k we deduce that can be decomposed into k where j is the run from mj vj to mj vj such that j wj conversely let vj jk be a sequence of vectors in nd such that k where j is a run from mj vj to mj vj we deduce that we have the following equality where mj mj vj and aj a a m ak observe that aj mj mj vj mj vj and in particular aj aj we deduce that moreover since src src and tgt tgt we deduce that ¢ since ¢ is a well order the following lemma shows that well order we have proved theorem lemma ¢ implies is a proof assume that m mk lemma shows that there exists a sequence of vectors in nd such that k where j is a run from mj vj to mj vj lemma shows that j hence vj vj j mj we deduce that v vk by composition since src tgt src tgt v vk we get from the previous inclusion production relations in this section we prove that production relations are theorem all other results or definitions introduced in the section are not used in the sequel theorem production relations are the following lemma shows that periodic relations are stable by composition in particular it is sufficient to prove that production relations m are for every marking m nd in order to deduce that production relations are for every run lemma we have qr r qr qr for every periodic relations over zd proof we have r qr and r qr thus r r c where c qr qr as c is a set we get qr r c for the converse inclusion let us consider x z c there exists y qd such that x y qr and y z qr there exists q such that x y r and y z r we introduce n n n such that n n and n n and we deduce that nx y r and ny z r with n nn hence nx z r r we deduce that x z qr r theorem shows that the set q m is if and only if the following set is finitely generated for every vector space v qd × qd q m v we introduce the periodic relation mv defined as the intersection m v let us observe that q m v is equal to q mv so we just have to prove that the set q mv is finitely generated for every m nd and for every vector space v qd × qd we introduce the set mv of runs such that src tgt m m is in nd × nd v note that a r s nd × nd satisfies r mv s if and only if there exists a run mv such that src m r and tgt m s we introduce the set of markings q that occurs in at least one run mv in general the set is infinite we consider the set of i d such that qi q is infinite we observe that if i there exists a sequence of markings in such that the ith component is strictly increasing we are going to prove that there exists a sequence of markings in such that every component in is strictly increasing this property is proved by introducing the an for m v is a triple r x s such that x nd r s nd × nd v and such that r m x m s since m is a periodic relation we deduce that the set of is stable by addition in particular m nx occurs in at least one run of mv for every r x s and for every n n hence if xi then i an for m v is said to be total if xi for every i lemma there exists a total for m v proof since finite sums of are it is sufficient to prove that for every i there exists an r x s for m v such that xi we fix i i let us first prove that there exists q q in such that qi q i since i i there exists a sequence of markings qn such that is strictly increasing since nd is well ordered we can extract for this sequence a subsequence that is non decreasing for we have proved that there exists q q in such that qi q i as q then q occurs in a run in mv hence there exists r s nd × nd v such that m r q m s as q there exists r s such that m r q m s let us introduce v q q we deduce · m r r q r from m r q · q v r m s v r from q m s · m r v s q v s from m r q · q s m s s from q m s since q r q v r and q v s q s we have proved the following relations where x s v r r r m x m s s as rr ss we deduce that rr x ss is an for m v since xi we are done let us introduce an additional element n and let n n a vector in nd is called an extended marking and the set i i d mi is called the set of relaxed components of an extended marking m given a finite set i d and a marking m nd we denote by mi the extended marking defined by mi i if i i and mi i mi if i i given a word w a ak of vectors aj a we extend the relation w over the set of extended markings relaxed over a set i by x w y if there exists a word m mk of extended markings relaxed over i such that x y m mk and for every j k and for every i di the word is unique and it is called the run from x to y labeled by w we introduce the finite graph q a e where q q and where e a p q q p a we introduce the periodic relation of r s nd such that ri si for every i and such that there exists a cycle in on the state labeled by a word a ak where aj a such that r pk j aj s lemma the periodic relation is presburger proof this is a classical result based on the fact that the parikh image of a regular language is presburger lemma the following equality holds q mv proof let us first prove the inclusion let r s such that r mv s in this case there exists a word w a such that m r w m s observe that m nr and m ns are in for every n n hence ri or si implies i and we deduce that w therefore w is the label of cycle in on we have proved that r s now let us prove the inclusion we consider r s in this case r s nd × nd v satisfies ri si for every i and there exists a word w a ak of vectors aj a that labels a cycle in on and such that m r pk j aj m s let us consider a total r x s for m v given p n and j k we introduce the following vector m r px a · · · aj let us first prove that there exists p n such that n for every i and j k let i and j k since xi there exists n such that n for every p we deduce that there exists p n such that n for every i and j k now we prove that n for every i and j k let j k since w is the label of a cycle on there exists an extended marking qj relaxed over such that the following relation holds qj we deduce that for every i we have mi ai · · · since ri and xi we get i n we have proved that nd for every j k since aj we deduce that p mp is a run note that mp m px r and m px r pk j aj m px s we have proved that the following relation holds m px r w m px s in particular r s is in the production relation m where m m px since a production relation is periodic we get m nr m ns for every n n as pr px ps is an for m v we get m pr m m ps we deduce the relation m pr nr m nr from m pr m and the relation m ns m ps ns from m m ps we deduce that the following relation holds for every n n m pr nr m ps ns hence pr s nr s mv thus r s q mv from the inclusion q mv we get the inclusion q mv lemma the set qp if finitely generated for every presburger periodic set p proof let us consider a presburger periodic set p since p is presburger then p sk j bj pj where bj zd and pj zd is a finitely generated periodic set we introduce the finitely generated set c pk j cj where cj is the finitely generated set cj since p c and c is a set we deduce the inclusion qp c as c is finitely generated we deduce that c is closed hence qp c for the other inclusion let p pj for every n n we have bj np p hence n bj p qp for every n n we deduce that p qp therefore pj qp we deduce that cj qp as qp qp we have proved the inclusion c qp hence the previous inclusion is in fact an equality now we can prove theorem lemma shows that is a presburger periodic relation lemma proves that the set is finitely generated lemma shows that q mv is finitely generated hence q m v is a finitely generated set for every vector space v qd × qd theorem shows that the relation q m is hence m is a periodic relation periodic relations is stable by finite intersections we deduce that p is periodic relation thanks to the previous lemma we deduce that m n p is a relation for every m n nd × nd and for every finitely generated periodic relation p nd × nd therefore is a petri relation and we have proved theorem conclusion the reachability problem for vector additions systems consists to decide for a triple m a n where m n are two markings of a vector addition system a if there exists a word w a such that m w n the following algorithm this problem reachability m a n k repeat forever for each word w a of length k if m w n return reachable for each presburger formula of length k if m and are true and x y x a a a return unreachable k k petri reachability relations in this section we prove the following theorem all other results or definitions introduced in this section are not used in the sequel theorem the reachability relation of a vector addition system is a petri relation the correctness is immediate and the termination is guaranteed by the following theorem theorem for every pair of markings m n in the complement of the reachability relation of a vector addition system there exists a partition of the set of markings into a presburger forward invariant that contains m and a presburger backward invariant that contains n we are interested in proving that is a petri relation this problem is equivalent to prove that m n p is a relation for every m n nd × nd and for every finitely generated periodic relation p nd × nd we introduce the order p over p defined by p p p if p p p since p is finitely generated we deduce that p is a well order over p lemma we introduce the set of runs such that src tgt m n p this set is well ordered by the relation p defined by p if src tgt m n p src tgt m n we deduce that min p is finite lemma the following equality holds m np src tgt p min p proof let us first prove let lemma shows that src tgt since src tgt m n p and p is periodic we deduce the inclusion let us prove let x y in the intersection m n p there exists a run such that x src and y tgt since p is a well order there exists min p such that p we deduce that x y is in src tgt we get x y src tgt p and we have proved the inclusion theorem shows is a periodic relation since p is a finitely generated relation we deduce that p is a periodic relation lemma shows that the class of proof let us consider x m and y n and let r be the reachability relation of the vector addition system theorem shows that r is a petri relation since r is reflexive and transitive and such that x × y r theorem shows that there exists a partition of the set of markings into a presburger forward invariant set that contains x and a presburger backward invariant set that contains y this algorithm does not require the classical decomposition note however that the complexity of this algorithm is still open in fact the complexity depends on the minimal size of a word w a such that m w n if m n and the minimal size of a presburger formula x denoting a forward invariant m such that m m and n m otherwise we left as an open question the problem of computing lower and upper bounds for these sizes note that the a large size but finite reachability set given in mm does not directly provide an for these sizes since presburger forward invariants can reachability sets as future work we are interested in providing complexity bounds on formulas in fo q denoting the sets q m references en j and m decidability issues for petri nets a survey of the european association for theoretical computer science ­ gs and h presburger formulas and languages journal of mathematics ­ of the reachability set is decidable for petri nets phd thesis university of s decidability of reachability in vector addition systems preliminary version in proceedings of the annual acm symposium on theory of computing may san francisco california usa pages ­ acm lam a structure to decide reachability in petri nets theoretical computer science ­ the general vector addition system reachability problem by presburger inductive invariants in lics pages ­ may w an algorithm for the general petri net reachability problem in conference proceedings of the annual acm symposium on theory of computation may usa pages ­ acm mm w and r meyer the complexity of the finite containment problem for petri nets j acm ­ theory of linear and integer programming john and sons new york st s and richard l the decidability of the reachability problem for vector addition systems preliminary version in conference record of the annual acm symposium on theory of computing may usa pages ­ acm 