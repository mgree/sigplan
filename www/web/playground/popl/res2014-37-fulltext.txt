parametric completeness for separation theories james dept of computer science university college london uk abstract in this paper we close the logical gap between in the logic bbi which is the propositional basis for separation logic and validity in an intended class of separation models as employed in applications of separation logic such as program verification an intended class of separation models is usually specified by a collection of axioms describing the specific model properties that are expected to hold which we call a separation theory our main contributions are as follows first we show that several typical properties of separation theories are not definable in bbi second we show that these properties become definable in a suitable hybrid extension of bbi obtained by adding a theory of naming to bbi in the same way that hybrid logic extends normal modal logic the extension captures most of the properties we consider and the full extension with the usual binder of hybrid logic covers all these properties third we present an axiomatic proof system for our hybrid logic whose extension with any set of pure axioms is sound and complete with respect to the models satisfying those axioms as a corollary of this general result we obtain in a parametric manner a sound and complete axiomatic proof system for any separation theory from our considered class to the best of our knowledge this class includes all separation theories appearing in the published literature categories and subject descriptors f logics and meanings of programs specifying and verifying and reasoning about of programs f mathematical logic and formal languages mathematical theory proof theory modal logic general terms theory verification keywords logic separation logic hybrid logic introduction essentially all models are wrong but some are useful g e p box and n r in mathematical logic there is a between in a deductive system which typically captures validity in some general class of models of the underlying logic and validity in the intended models of practical or theoretical interest for permission to make digital or hard copies of part or all of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page for components of this work must be for all other uses the popl january ­ san diego ca usa copyright is held by the acm example as demonstrated by there are statements of arithmetic pa that hold in its intended model ie the natural numbers n but not in all of its possible models and so these statements are not provable in pa this incompleteness of logical proof systems with respect to a particular choice of intended models is for sufficiently expressive systems in other cases it might happen that a logical system is complete but expressive to capture the interesting properties of the intended model that is some mathematical property of the model cannot be expressed by any formula of the logical language in which case we say that the intended models are not definable or within the system thus when a logical system there are at least two natural and essentially independent questions first whether the language of the system is expressive enough to the intended models and second whether the system is complete for validity in these intended models in this paper we consider these questions in the context of separation logic an established formalism for reasoning about programs the purely propositional part of separation logic is usually considered to be given by boolean bi from now on bbi which is a particular of logic obtained by freely combining the connectives of multiplicative intuitionistic linear logic with those of standard classical logic in bbi corresponds to validity in the general class of relational commutative monoids applications of separation logic on the other hand typically deal with specific such models or classes based on the composition of heaps see for a survey of the models used in practice these heap models exhibit various interesting mathematical properties that are not true of all relational commutative monoids and thus are not captured by in bbi for example composition of disjoint heaps is a partial binary function which is a special case of the relation in a relational commutative monoid various collections of such properties have been advanced in the literature as abstractions over concrete heap models suitable for program analysis under the common name of separation algebra we list the model properties commonly found in the literature in definition and call a given collection of such properties a separation theory our aim is to obtain logical proof systems in which accurately captures validity in the class of models determined by a separation theory and by adding as little extra machinery as possible to bbi in this paper we make three main contributions · first we show in section that bbi is expressive to most separation theories specifically we show that several commonly considered model properties are not definable by any eg partial functionality andor of the composition operation of a property means that the logic is of distinguishing models with the property from those without it in particular we find that none of the three different classes of separation algebras found in the literature are definable in bbi · second we introduce in section a simple hybrid extension of bbi which the same relation to bbi as normal hybrid logic does to normal modal logic see for an overview that is extends bbi with a theory of naming we introduce a second sort of atoms called which are interpreted as individual states in a model and we also add a unary hybrid modality by the nominal so that the hybrid formula a is satisfied at any world in a model just when a is satisfied at the world denoted by the nominal despite the simplicity of this extension which is conservative over standard bbi the hybrid logic is expressive enough to define most of the separation theories we consider including in particular all three concepts of separation algebras from the literature however for more complex model properties such as the property of still more expressivity is required we show in section how to gain this expressivity by adding the binder of hybrid logic to · third we provide a axiomatic proof system for that is sound and complete with respect to any given separation theory that is whenever the proof system is extended with the axioms defining a separation theory the resulting extension is sound and complete with respect to the class of models determined by that theory eg by adding the axiom defining we obtain a sound and complete proof theory for models such axiomatic proof systems provide a useful of validity in separation theories which can be used as a for eg tableau or proof systems we present the axiom system and its soundness result in section and give the completeness theorem in section section extends these results to with the binder related work most of our technical results are obtained by of techniques from modal and hybrid logic this should come as no since logics can quite straightforwardly be seen as modal logics indeed this view has been exploited previously in the literature on logic eg to obtain completeness results however as far as we know this paper represents the first explicit introduction of hybrid logic into the setting of abstract separation logic in particular previous work on hybrid logics has been confined to modal logic with unary modalities connected by de morgan duality whereas in this setting we consider the case of binary modalities connected by interestingly the key concept from hybrid logic ie the explicit naming of elements in the underlying model has been used implicitly several times in the literature on the proof theory of bbi for example the labelled tableau system for bbi which was recently proven complete for partial functional relies on a system of semantic labels which pick out individual model states in much the same way as nominal atoms in hybrid logic even more recently labelled nested and sequent calculi for bbi have appeared semantic labels in a similar way while such works add names or labels to proof systems as auxiliary tools for simplifying proof search in standard bbi here we consider these features to be firstclass components of the logic indeed we believe that it should be possible to adapt the labelled proof systems in the literature to yield proof theories for our hybrid extensions of bbi in a similar the explicit naming of heaps arises naturally in several extensions of separation logic as an aid to practical program verification reynolds that referring explicitly to the current heap in specifications would allow one to verify programs that manipulate data structures with sharing such as graphs et al recently this claim by providing automatic verification techniques for such programs where specifications are written using a constraint language based on separation logic with explicit heaps in an independent line of research david and introduced immutable specifications which extend separation logic to support the tagging of certain parts of the heap as immutable this can be viewed as adding a heap label in the precondition of a command corresponding to the immutable part and the same heap label in the postcondition the hybrid logics introduced in this paper can be seen as providing a common formal foundation for adding explicit heap atoms and modalities to separation verification our main focus here is on the precise expressivity of these logics syntax and semantics of bbi in this section we introduce formulas of bbi and their kripke semantics given by relational commutative monoids cf definition let v be a infinite set of propositional variables are built from propositional variables p v using the usual connectives ¬ of classical logic and the socalled multiplicative connectives consisting of the constant i and binary operators and by convention ¬ has the precedence followed by and with and having lowest precedence definition bbi frames and models a is a a tuple w e where w is a set of worlds w × w pw and e w we extend pointwise to pw × pw pw w w def w w a w e is a if is commutative and associative and w e w for all w w that is w e w for all e e and w e w for some e e we call e the set of units of the model w e definition let m w e be a bbi frame a valuation for m is a function that assigns to each propositional variable p v a set p w given any valuation for m any w w and any a we define the forcing relation m w a by induction on a m w p w p m w always m w never m w ¬a m w a m w a a m w a and m w a m w a a m w a or m w a m w a a m w a implies m w a m w i w e m w a a w w w w w w and m w a and m w a m w a a w w w if w w w and m w a then m w a a is said to be valid in m if m w a for all valuations and for all w w a is valid if it is valid in all definition we define to be the proof system obtained by extending a complete system for classical logic with the following axioms and inference rules for and i where a b is syntactic sugar for the formula a b ab ba a b c a b c a ai a b a b a a b b ai a ab c a b c a b c ab c and showed that is sound and complete with respect to where the set of units is a singleton cf definition the corresponding result for our setting is an easy corollary theorem a is iff it is valid definable and properties in bbi in this section we review a number of interesting properties of encountered in the literature on separation logic and examine whether or not these properties can be or defined by formulas of bbi specifically we show that several such properties are not definable in bbi by showing that they are not generally preserved by model constructions definition separation theories letting m w e be a we introduce the following properties of interest partial functionality w w w w implies w w w w w w implies w w single unit e ie w w e implies w w units w w e implies w e disjointness w w implies w e for every w e there are w w e such that w w w property whenever t u v w there exist tv tw uv uw such that t tv tw u uv uw v tv uv and w tw uw any given collection of model properties from the above list is called a separation theory all the above axioms are true of standard heap models with the exception of which arises naturally in models with fractional permissions the of the individual properties is explained in more detail in where disjointness and are referred to as and respectively various different separation theories have been considered in the literature on separation logic for example a that is both partial functional and is called a separation algebra in while in the same term defines a that is partial functional and with a single unit and in the views framework of the same term again refers to a that is simply partial functional in bbi we now examine which of the characteristics of separation theories are definable within bbi we notation slightly by identifying a property of with the class of satisfying that property definition given a language l of formulas a property p of is said to be if there exists an a such that for all m a is valid in m m p we remark that could equally well be defined on not just note that the property of being a among all frames is itself take as the defining formula the conjunction of the top four axioms in definition which define associativity commutativity and the unit law e w w however we shall be concerned mainly with the properties of listed in definition proposition the units property and the property are both as follows units i a b a iu div proof the case of the units property is shown in for the case of we proceed as follows assume that m is let be a valuation for m and let w w to show that div is valid we suppose that m w ie that w e and require to show that m w gives us w w w e such that w w w thus m w assume that div is valid in m and suppose that w w e then m w hence we have m w by validity of div this gives us w w such that w w w where m w and m w ie w w e as required in bbi here we show that four of the properties of are not definable in bbi partial functionality disjointness and single unit first we introduce the bounded image and disjoint union constructions for and show that they preserve validity in a given model which the situation arising from their in modal logic our results follow from the fact that the first three of the above properties are not preserved by bounded while the last one is not preserved by disjoint unions definition bounded image let m w e and m w e be a bounded morphism from m to m is a function f w w satisfying the following w e iff f w e w w w implies f w f w f w f w w w implies w w w w w w and f w w and f w w w f w w implies w w w w w w and f w w and f w w we say m is a bounded image of m written m m if there is a bounded morphism from m to m lemma let m and m be with m m then any valid in m is also valid in m proof we write m w e and m w e and let f w w be a bounded morphism from m to m suppose for contradiction that a is valid in m but not in m thus there exists a valuation for m and w w such that m w a we define a valuation for m as follows p def w w f w p as f is there is a w w such that w f w to obtain the required contradiction we claim that m w a to show this claim we prove by structural induction on a that for all w w we have m w a if and only if m f w a we omit the cases for the classical connectives as they are straightforward by induction hypothesis case a p v using the definition of we have as required m w a w p f w p m f w p case a i using condition in we have as required m w i w e f w e m f w i case a b c that m w b c we have w w w with m w b and m w c using condition in we have f w f w f w furthermore by induction hypothesis m f w b and m f w c thus m f w b c as required that m f w b c we have f w w w with m w b and m w c by condition in there are w w w with w w w and f w w and f w w thus by the induction hypothesis we have m w b and m w c hence m w b c case a b c suppose m w b c to show that m f w b c we assume that w f w w and m w b and must show m w c by condition in there are w w w with w w w and f w w and f w w thus by the induction hypothesis m w b since m w b c we obtain m w c which yields the required m w c by induction hypothesis suppose m f w b c to show that m w b c we assume that w w w and m w b and must show m w c by condition in we have f w f w f w and by induction hypothesis we have m f w b since m f w b c we obtain m f w c which then yields the required m w c using the induction hypothesis this completes all cases lemma let p be a property of and let m m be such that m p m p and m m then p is not proof suppose for contradiction that the a is valid in exactly those with property p then a is valid in m by lemma a must be valid in m since m m hence m p the assumption that m p in fact lemma applies to as well as and implies that if m m and m is a then so is m otherwise the class of all would not be among all contradiction the following result shows that separation algebras as defined by the views framework are not theorem partial functionality is not proof by lemma it suffices to exhibit a pair of m and m such that m is partial functional m is not partial functional and m m we define m w e and m w e as follows w def e v v x x y z e def e w e e w def w for all w w x v v x def y x v v x def z x v v x def y x v v x def z w def e v x y z e def e w e e w def w for all w w x v v x def y z with w w w w def for all other w and w first we verify that m and m are indeed com and the unit law hold in both models by construction associativity of and is straightforward to check since w w w and w w w are always empty unless one of w w w is e next we note that m is partial functional since w w for all w w w by construction whereas m is not partial functional since z y x v but z y finally we claim that m m ie that there is a bounded morphism from m to m define f w w by f v f v def v f w def w f x f x def x w e y z clearly f is so it just remains to check the four bounded morphism conditions in definition trivial since e e e and f e e we just check that every membership statement in the definition of maps under f to a corresponding membership statement in the definition of eg since y x v we need to check that f y f x f v ie y x v which is the case we need to check that every membership statement f w w w in the definition of can be traced back under f to a corresponding membership statement in the definition of eg since f z x v we need w w such that z w w and f w x f w v by taking say w x and w v we are done similar to item above but for membership statements of the form w f w w eg since y f v x we need w w such that w v w and f w x f w y by taking w x w y we are done we remark that there is no a priori connection between of a property on the one hand and the existence of complete proof systems for models having the property on the other in particular theorem says nothing about the existence of proof theories for bbi that are complete for partial functional models in fact and showed in that is incomplete for such models what theorem shows in addition is that if one were to add perhaps infinitely many axioms to so as to obtain a complete system for partial functional models then in this system still would not all models that are not partial functional one can contrast this situation eg with that of commutativity axiom a b b a which is easily seen to define commutativity and therefore to all models theorem is not proof by lemma it suffices to exhibit a pair of m and m such that m is m is not and m m we define m w e and m w e as follows w def e v v x y z z e def e w e e w def w for all w w x v v x def z y v v y def z x v v x def z y v v y def z w def e x v y z e def e w e e w def w for all w w v x x v v y y v def z with w w w w def for all other w and w first it is straightforward to verify that m and m are indeed with associativity holding because implies one of w w w is e and similarly for next we note that m is because by construction w w w w w implies w w on the other hand m is not for z v x v y but x y finally we need a bounded morphism from m to m we define a map f w w by f v f v def v f w def w f z f z def z w e x y the verification that f is indeed a bounded morphism is similar to that in the proof of theorem notice that the proof of theorem in fact maps a model that is both partial functional and with a single unit to a model thus it also establishes that neither the class of models that are partial functional and the separation algebras of nor the subclass of such models having a single unit the separation algebras of are theorem disjointness is not proof by lemma it suffices to exhibit a pair of m and m such that m is disjoint m is not and m m we define m w e and m w e by w def e x y e def e w e e w def w for all w w x y y x def x y w def e x e def e w e e w def w for all w w x x def x with w w w w def for all other w and w similar to the previous theorems and we can easily verify that m and m are indeed with m disjoint by construction whereas m is not disjoint since x e and x x we define a bounded morphism f from m to m by f e def e f x def x f y def x it just remains to check the bounded morphism conditions which is similar to the in theorems and the fact that the property is not is a straightforward consequence of existing completeness results we also present a direct proof for interest theorem the property is not proof the result can be from the completeness result for in suppose for contradiction that the property is definable by the formula a then by completeness a is provable in hence by soundness theorem a is valid in all some of which fail to have the property theorem can also be shown more directly we show that the property is not preserved under the following disjoint union construction which preserves validity definition disjoint union let m w e m w e be where w and w are disjoint sets then m m the disjoint union of m and m is defined as m m def w w e e where w w × w w pw w is defined as i on and undefined on and lemma let m m be then any valid in both m and m is also valid in m m proof we write m w e and m w e suppose for contradiction that a is valid in m and m but not in m m thus there exists a valuation and w w w such that m m w a we show the case where w w the case w w is similar we define a valuation for m by p def p m to obtain the required contradiction we claim that m w a the that a is valid in m to show this claim we prove that for all w w we have m w a if and only if m m w a this is easily established by a straightforward structural induction on a which we omit lemma let p be a property of and suppose that there exist m and m such that m m p but m m p then p is not proof similar to the proof of lemma note that it is straightforward to show that if m and m are then so is m m alternatively similarly to lemma lemma implies that otherwise would be among all contradiction alternative proof of theorem let m n and m n be disjoint isomorphic copies of the monoid of natural numbers under addition m and m are both but m m is not as its set of units is thus by lemma the property is not we have not yet considered the property from definition in section we show that this property is definable in a relatively strong hybrid extension of bbi including a binder see proposition the of expressing the property even in that logic leads us to strongly it is not definable in bbi conjecture the property is not is preserved by bounded disjoint unions and by generated cf we believe it should be possible to show its in bbi by a model construction based on extensions cf but that is beyond the scope of the present paper a basic hybrid extension of bbi in this section we present an extension of bbi called based upon a simple fragment of hybrid logic this extension allows us to refer to individual elements of the underlying as opposed to sets of elements as denoted by by introducing a second sort of propositional variables called we also introduce a new modality enabling us to evaluate a formula at the world denoted by the nominal the additional expressivity of enables us to define the separation theory properties shown in the previous section to be in bbi definition we assume a fixed infinite set n of disjoint from the propositional variables we write lower case letters j k etc for to distinguish them from propositional variables a is defined as a except that a any nominal n counts as an atomic and b if a is a and a nominal then a is a a is said to be pure if it contains no propositional or formula variables definition a hybrid valuation for a m w e extends a standard valuation see by additionally mapping every nominal n to an element w given any hybrid valuation for m any w w and a a we define the forcing relation m w a by extending the definition of the forcing relation in with the following clauses for and the modality m w w m w a m a a is then said to be valid in m if m w a for all hybrid valuations and all w w and simply valid if it is valid in all we observe that is a conservative extension of bbi that is every a is valid according to definition if and only if it is valid according to definition because the forcing relations in the two definition coincide on thus every property of definable in bbi in particular those described in proposition is also definable in however is strictly more expressive than bbi several properties not definable in bbi become definable in theorem the following properties from definition are via pure formulas functionality single unit units disjointness j k j k j k i i i j k i su iu dis proof we treat each property functionality assume m is partial functional let be a valuation for m and let w w to show that is valid in m we assume that m w j k j k and must show that m w ie that by assumption we have j k and j k hence by partial functionality of m we have as required assume that is valid in m and suppose w w w w we require to show that w w since is valid in m we have m w for all w w and for any hybrid valuation we define a hybrid valuation for m as follows w w j w k w then showing that w w means showing that m ie that m w as is valid in m it suffices to show that m w j k j k since w w w w by assumption and m w j and m w k by construction we obtain that m w j k and that m w j k from which the result follows assume m is let be a valuation for m and let w w to show that is valid in m we suppose that m w j k and require to show that m w jk ie that j k that m w j k straightforwardly means that w j k by we thus im get that j k as required assume that is valid in m and suppose w w w w w we require to show that w w since is valid in m we have m w for all w w and hybrid valuations we define a hybrid valuation for m as follows w j w k w then by assumption m w j k by validity of we deduce that m w jk hence that j k and by construction that w w single unit assume e e let be a valuation for m and let w w we show su is valid that m w i i we have that e thus e which yields m w as required assume su is valid and let e e e we need to show e e define a valuation for m by e and e thus to show e e it suffices to show m w for any w w since su is valid it suffices to show that m w i i this follows from our construction of units the equivalence holds by a straightforward modification of the argument for the formula iu see in prop disjointness assume the disjointness property let be a valuation for m and let w w to show dis is valid we suppose that m w and require to show that m w i ie that w and w e that m w means that w in particular hence by disjointness e we thus get w hence w and also w e as required assume that dis is valid in m and suppose that w w we require to show that w e let w w w and be such that w by construction we have that m w hence by validity of dis we get m w i ie w w and w e hence w e as required corollary any separation theory from def not including the property is by pure formulas proof follows by taking as the defining formula the conjunction of the relevant formulas from theorem and proposition as is also the case for bbi see conjecture we but do not know that the property is not definable even in this is because a straightforward translation of the property into would require some way of binding or existentially which is not provided by pure or the modality in section we add a binder to which enables us to express an axiomatic proof system for here we present a axiomatic proof system for and show that it is sound with respect to validity in we examine questions of completeness in section in the rest of the paper it will often be convenient to reason in terms of the de morgan dual of defined as a b def ¬a ¬b the and yields the following forcing relation for m w a a w w w w w w and m w a and m w a using rather than means that we deal exclusively with modalities with an existential interpretation which frequently makes life easier in our technical developments definition we define to be the proof system obtained by extending the proof system see definition with the axioms and rules for and given in figure is based on the proof system for basic hybrid logic in we have chosen the axioms and rules so as to make the subsequent completeness proof as simple as possible proposition any formula is valid proof let m w e be a then assuming a is we must show that a is valid in m it suffices to show that all axioms of are valid and that validity k intro refl sym a b a b a ¬ ¬a and ¬ ¬a a a k k a a subst a a gen a a not in a name a agree k ka a k a a and a k a k k ka k b a b k k ka k b a b k k ka k b c k k not in a b c or a b c k k ka k b c k k not in a b c or a b c figure rules and axioms for in note that in the the rule subst is a substitution of for is preserved by every proof rule of this is a straightforward verification for all the rules and axioms except the two axioms and the two rules we just show the cases of and here as the others are similar case let be a valuation for m and let w w suppose m w k k ka k b then we have m k k and m k a and m k b the first of these means that k k thus m a b ie m w a b as required case let be a valuation for m and let w w the premise of the rule is valid in m and m w a b we have to show m w c we have m a b which means that there exist w w w such that w w and m w a and m w b now define the valuation k w k w where k and k are the fresh appearing in the premise of the rule by construction and using the fact that and agree except possibly on the fresh k k we have k k and m k a and m k b the first of these gives us m k k putting everything together we obtain m w k k ka k b since the premise of the rule is valid by assumption we obtain m w c again since and agree except on k k which do not appear in c we thus obtain m w c as required the following example illustrates how the hybrid axioms and rules are used in practice example the i a a is provable in intuitively the lhs of this formula says that from the current world w one may find a unit e such that w e is defined and e is defined and satisfies a this implies that itself satisfies a proof first we show that the following formula is provable a b b let j k k be fresh not occurring in a b or we have k b b an instance of agree by weakening for we thus obtain jk k ka k b b using the fact that k k are fresh we can apply the rule to derive ja b b since the formula j a b ja b is an instance of intro we obtain j a b b by transitivity and thus easily we have j a b b since j is fresh we obtain a b b by applying name next we show that the following formula is provable i a a we have a a an instance of intro by and use of we obtain ¬a ¬a now since ¬a ¬a is provable as an instance of above we obtain ¬a ¬a by straightforward tions of plain bbi we can prove i ¬a ¬a thus by transitivity we obtain i ¬a ¬a this to i ¬a ¬a and then to i a ¬ ¬a which yields the required by using now we can supply the required derivation of the formula in the proposition we can derive i a a using as a a is an instance of we have i a a by transitivity as required interestingly the converse of the formula in example that is a i a is not generally valid but is valid in all models and thus in such models is definable already using plain this is because in models with a single unit e the composition w e must be defined for all w w whereas this might fail in models with multiple units the modality enables us to talk about worlds not accessible from the current world via the i and modalities but in models there are no such worlds completeness for pure extensions of in this section we show a parametric completeness result any extension of with a set of pure axioms ax is complete with respect to the class of satisfying ax in particular we can obtain complete proof systems for many separation theories simply by adding the axioms defining the theory to we follow the basic structure of the corresponding completeness proof for normal hybrid logic in which shows that any consistent set of formulas has a model based upon named maximal consistent sets compared to this proof we two additional difficulties first we have to work at least implicitly with the binary connectives and as opposed to a single modality and its de morgan dual second we have to show that the model we construct is a as opposed to an unrestricted frame definition consistent set let k be any proof system a set of formulas is said to be if there are formulas a an such that a an is provable in k otherwise is called definition maximal consistent set let k be any proof system a set of formulas is maximal and we call a if is and any is in the rest of this section whenever we talk about consistency and we always mean with reference to a fixed but arbitrary extension ax of with a finite set ax of axioms expressed as pure formulas we begin by some basic facts about lemma for any and formulas a b we have if a b is provable and a then b and either a or ¬a a b iff a b a b iff a or b proof standard in all cases in the following we do not refer explicitly to uses of lemma as we use it so frequently definition named an is said to be named if there is at least one nominal any such is called a name for is said to be if · a b implies a b for some and · a b implies a b for some lemma extended lemma let n be a infinite set of disjoint from n if is a consistent set of formulas then there is a named of formulas in the extended nominal language of n n such that proof let k k k be an enumeration of n and let b b b be an enumeration of all formulas in the extended language given by n n given a consistent set of formulas we define a sequence ii of sets of formulas as follows · def k · if i bi is inconsistent then i def i · if i bi is consistent and the formula bi is not of the form a b or a b then i def i bi · if i bi is consistent and bi a b then i def i bi k k ka k b · if i bi is consistent and bi a b then i def i bi k k ka k b where k k in the first and last two clauses are fresh from our enumeration of n we claim that def i i is a named first to see that is consistent it suffices to show that i is consistent for all i we proceed by induction on i in the case i we must show that k is consistent if not then there are formulas a an such that writing a in ai we have a k provable thus k ¬a is provable by the rule name we have ¬a provable and thus a provable the consistency of now assuming that i is consistent we must show that i is consistent this is immediate by induction hypothesis except in the case that bi a b or bi a b we show the case bi a b in this case assume for contradiction that there are a an i such that writing a in ai the following is provable a a b k k ka k b thus we can also prove k k ka k b ¬a ¬ a b since k k are fresh we obtain by applying a b ¬a ¬ a b thus we obtain a a b the assumed consistency of i bi the case bi a b is similar using the rule next we must show that is maximal suppose that for some formula a we have a consistent but a note that a appears in our enumeration as bi say so by construction it must be that i a is inconsistent otherwise a i but then a is inconsistent contradiction next to see that is named observe that k for some nominal k by construction finally we show is first suppose ab note that a b appears as some bi in our enumeration now every finite subset of an is consistent so i bi must be consistent thus by construction we have k k ka k b i as required for similar reasons whenever a b we have k k ka k b in the following we define a named set by to be any set of formulas a a for some nominal lemma let be an and let def a a be the named set by for each nominal then the following hold for all k is an containing if k then k a k iff a if is a name for then proof the proof of the analogous result for normal hybrid logic stated as lemma in suffices for our setting definition a w e is named by the hybrid valuation if for all w w there is an n with w definition let be a named then the named model by is defined as m def w e where w is the set of all named sets by def a a implies a a e def i the canonical valuation for m is defined by p def p p a proposition def a a a nominal we show that m is indeed a in lemma but require for the intermediate results only that m is a we observe that m is indeed named by for any w we have a a for some lemma existence lemma for for any w if a a then there exist w such that and a a proof let a a we have a a for some nominal thus a a as is we have such that a a thus a and a where a a and a a are named sets by it just remains to show that let b b by definition b and b as are closed under and conjunction we have b b thus using the rule we have b b thus b b as required lemma if and only if for all formulas a and b a and b implies a b proof we show each direction separately making use of the fact that are by part of lemma assume the righthand side of the implication and let a and a we must show a a suppose for contradiction that a a since is an ¬a a by assumption a ¬a a ie ¬a a as is an we have a ¬a a a but a a a a is provable hence so is a ¬a a a this contradicts the consistency of hence a a as required let a b and suppose for contradiction that a b as is an we have a ¬b so by the main assumption a ¬b a as is an and a ¬b a ¬b is provable ¬b this contradicts the consistency of so a b as required lemma existence lemma for for any w if a a then there exist w such that and a a proof we have a a for some nominal since a a by assumption a a as is we have a a for some we obtain named sets a a and a a by with a and a it remains to show that by lemma it suffices to show that a and b implies a b a b we have a and b thus we obtain a b since is an it is closed under the rule and it follows that a b thus a b as required lemma truth lemma for any a and w we have m a if and only if a proof by structural induction on a we omit the cases for the classical connectives as these are straightforward by induction hypothesis using the properties of and the fact that any named set by is an see part of lemma case a p using the definition of we have as required m p p p case a using the definition of we have m a a now going from left to right we have a a and thus by part of lemma conversely assuming we have that a ka for some k and by part of lemma we obtain a a as required case a i using the definition of e we easily have as required m i ec i case a a a using the induction hypothesis we have m a a and m a and m a and a and a going from left to right we immediately get a a as required from the definition of going from right to left we have a a and must construct the required named sets by satisfying the statement above this is precisely guaranteed by our existence lemma for lemma case a a a using the induction hypothesis for a and a we have m a a and m a implies m a and a implies a going from right to left assume that a a a and by the definition of we have a aa we obtain a as required by going from left to right we must show that a a given the above implication we show the assume that a a ie ¬a a we must construct named sets by with and a but a ie ¬a this is provided by our existence lemma for lemma case a b using the induction hypothesis for b we have m b m b b b a a b now using part of lemma we have that b if and only if b this completes the case and the proof lemma let m w e be the named model by the named then m is a proof we must show that m satisfies the axioms in commutativity it suffices to show that let and suppose a a to show we have to show a a as we have a a as are closed under and a a a a is provable we have a a associativity it suffices by commutativity to show assume that which means that for some we have using part of lemma we have such that i i for each i as we have thus as we have by applying associativity is provable so by two applications of the existence lemma for lemma we obtain named sets w such that i i for each i and and by part of lemma i i for each i hence as required unit law we must show that e for any w first we show that e suppose e ie there is a e e such that e we need to show first suppose a and note that i e by definition by definition of we have i a and as i a a is provable we must have a thus to see that as required we just observe that if then as is consistent is not maximal contradiction we still need to show that e ie that e for some e e using part of lemma we have some since i is provable we have i using the existence lemma for lemma we obtain named sets e w such that e and i e and thus e e and by part of lemma this completes the proof lemma let m w e be a named by and let a be a pure formula suppose that m w a for all w w and nominal substitutions then a is valid in m proof letting be a hybrid valuation and w w we must show that m w a since m is named by we have that for any n there is a k n such that k thus we can define the substitution of for by is the first k n with k by hypothesis we have that m w a for all w w we now prove by structural induction on a that m w a in the case that a is a nominal we must show that w and are done since by assumption w note that a cannot be a propositional variable since it is assumed pure the other cases follow by induction hypothesis theorem completeness let ax be a set of pure then if a is valid in the class of satisfying ax then it is provable in ax proof let c be the class of satisfying ax suppose a is valid in all m c but not provable in ax then ¬a is consistent using the extended lemma we can construct a named ¬a now let m w e be the named model by and the corresponding canonical valuation by lemma m is a furthermore for any pure formula b ax and any nominal substitution we have that b is provable using the rule subst which means that b for all w since are closed under by the truth lemma we obtain m b for all b ax w and substitutions thus by lemma all formulas in ax are valid in m ie m c thus by the main assumption a is valid in m since is named by construction we have w by part of lemma since ¬a we have m ¬a by the truth lemma that is m a thus a is not valid in m contradiction we conclude a is provable in ax corollary let s be any separation theory from definition not including the property and let ax be the set of pure formulas defining s as given by corollary then a is provable in ax if and only if it is valid in the class of satisfying s proof follows from prop thm and cor with the binder in this section we study the extension of with the binder from hybrid logic specifically we show that the property from definition is definable in this extension called and we show how to extend our soundness and parametric completeness results for in the previous sections to the setting of formulas and expressivity definition a is defined as for except that if a is a and a nominal then a is a definition given any hybrid valuation for a m w e and any w w we extend the forcing relation for in by the following clause for the binder which binds the given label to the current world m w a m w w a where w is notation for the hybrid valuation defined as except that w def w the definition of validity for then extends immediately to proposition the property see definition is definable in via the following pure formula a b c d a ac a ad ad b bc b bd bd bc bd cs proof we use the following formula abbreviations c def bc bd b def b bc b bd bd c a def a ac a ad ad b using the fact that ac ad and a are distinct we have for any m w e valuation and w w m w a m a ac a ad ad b w w a w w and m w ac a ad ad b m w a ad ad b m a ad ad b w w a w w and m w ad ad b m w ad b m a ac ad b w w a w w and m a b by a similar chain of reasoning we have m a b w w b w w and m b c finally we have m b c c w w and d w w putting everything together we have m w a w w w w a w w b w w c w w d w w with the above equivalence for a in place we can now show that cs defines the property of definition suppose m has the property we require to show that the formula cs is valid in m ie that if m w a b c d then m w a m w a b c d we have w a b c d by the property there then exist ac ad bc bd w such that a ac ad b bc bd c ac bc and d ad bd thus by the equivalence above m w a as required suppose the formula cs is valid in m we require to show that m has the property suppose w t u v w define a hybrid valuation for m by a t b u c v d w where a b c d are distinct we have that m w a b c d thus as cs is valid in m we have m w a using the equivalence above there then exist tv tw uv uw w such that t tv tw u uv uw v tv uv and w tw uw as required the binder of also allows us to encode the definition of the overlapping conjunction of separation logic which has been used in specifying and verifying programs manipulating data structures with sharing in these works is introduced as an new primitive connective defined by extending the standard forcing relation for bbi definition as follows m w a a w w w w w w w w w and w w w and w w w and m w a and m w a we give below an equivalent formulation of a a solely in terms of connectives we conjecture that this is not possible in bbi for arbitrary a and a proposition for any formulas a and a the overlapping conjunction a a is definable via the following formula where and s do not occur in a or a s s a s a s proof let m w e be a a valuation for m and w w m w s s a s a s m w w s s a s a s w ws ws and m ws w s s a s a s m w w s a s a s w w w w w w w and w w w and m w s a and m w s a and m w s letting w s ws notice now that m w s a w w w w w and m w s and m w a w w w ws and m w a consequently after applying a similar line of reasoning to w m w s s a s a s w w w w w w w w w and w w w and w w w and m w a and m w a m w a a since and s are sufficiently fresh this is equivalent to m w a a a variant a b a of the overlapping conjunction was introduced in to deal with some forms of specified sharing this variant tags the shared core of a and a with a formula b that it satisfies its satisfaction is defined as follows m w a b a w w w w w w w w w and w w w and w w w and m w a and m w a and m w b it is easy to modify the defining of proposition so as to accommodate this variant s b s a s a s proof theory soundness and completeness definition we define to be the proof system obtained by adding the following axiom schema to bind j b bj lemma nominal substitution lemma we have for any model m w e hybrid valuation a and j m j aj m j j a where j is a nominal substitution proof by structural induction on a the cases not involving are straightforward we examine the nominal cases making use of the identity jk kj case a k n the required equivalence becomes m j kj m j j k ie j kj j jk which follows from the identity above case a kb we have kj bj noting that is not a binder so the nominal substitution applies to the argument k and proceed as follows m j kj bj m kj bj m jk bj m jk j b m j j kb by above identity by ind case a k b without loss of generality we can assume that k in this case we have k bj k bj and can proceed as follows m j k bj m j kj bj m j kj j b m j b m j j k b by ind this completes all cases proposition any formula is valid proof given the soundness of proposition we just need to show that the new axiom bind is valid in all let m w e be a let be a valuation for m and let w w we need to show that m w j b bj ie m j b m j bj ie m j j b m j bj which is guaranteed by lemma we can obtain a parametric completeness result for by the model construction for in section the only difference is that the crucial truth lemma needs to be extended to account for the binder case cf lemma extended truth lemma for any a and w we have m a if and only if a proof by induction on the size of a with all cases except a b covered by lemma in this case using the fact that a ja for some nominal j we proceed as follows m b m b m j b m bj by lemma bj by ind now since is an and thus closed under k and the new axiom bind we have if and only if j b if and only if b which completes the case theorem completeness let ax be any set of pure then if a is valid in the class of satisfying ax then it is provable in ax proof exactly as theorem using the extended truth lemma lemma for in place of lemma corollary let s be any separation theory from definition and let ax be the set of pure formulas defining the properties s as given by corollary and proposition then a is provable in ax if and only if it is valid in the class of satisfying s proof follows from thm and cor conclusions and future work in this paper we show that many separation theories that arise naturally in applications of separation logic and in particular the various notions of separation algebras introduced in the literature so far are not definable in the standard propositional basis for separation logic namely bbi to overcome these limitations in expressivity we introduce new hybrid versions of bbi obtained by bbi with the machinery of hybrid logic in which the separation theories are definable in addition we show how to obtain axiomatic proof systems for these hybrid logics that are sound and complete for any separation theory obtained by combining properties from a list of those we found in the separation logic literature in future work we plan to explore possible applications of our hybrid logics to program analysis eg by adding support for to separation logic more we hope that our introduction of more expressive between bbi and full firstorder logic will help facilitate the expression and verification of more complex program properties particularly those involving overlapping data structures acknowledgments many thanks to yang for pointing out to us the need for lemma and to for crucial typing was supported by an acceleration and by the grant references p m de and y modal logic cambridge university press p and b ten pure extensions proof rules and hybrid g e p box and n r empirical and response series in probability and mathematical statistics john sons inc j and c calcagno classical bi its semantics and proof theory logical methods in computer science j and m undecidability of propositional separation logic and its to appear in journal of the acm c calcagno d p ohearn and h yang compositional shape analysis by means of journal of the acm c calcagno p and u context logic as modal logic completeness and parametric in popl acm c calcagno p ohearn and h yang local action and abstract separation logic in lics ieee computer society r and j o local reasoning for abstraction and sharing in acm c david and wn immutable specifications for more concise and precise verification in oopsla acm t l birkedal p m j parkinson and h yang views compositional reasoning for concurrent programs in popl acm r a and a w appel a fresh look at separation algebras and share in springer g j j and n c h program reasoning with heaps and separation to appear in cp d and d expressivity properties of boolean bi through relational models in springer k on formally undecidable propositions of and related systems translation by b a and j the of sharing in data structures in popl acm z a and r a labelled sequent calculus for boolean bi proof theory and proof search to appear in s and p w ohearn bi as an assertion language for mutable data structures in popl acm d the formal strong completeness of boolean bi submitted d and d exploring the relation between intuitionistic bi and boolean bi an embedding mathematical structures in computer science d and d the undecidability of boolean bi through phase semantics in lics ieee computer society j park j and s park a theorem prover for boolean bi in popl acm d the semantics and proof theory of the logic of implications applied logic series j c reynolds separation logic a logic for shared mutable data structures in lics ieee computer society j c reynolds a short course on separation logic h yang o lee j berdine c calcagno b cook d and p ohearn scalable shape analysis for systems code in cav springer 